<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>Vcg</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/plf.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 2: Programming Language Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">Vcg</h1>

<div class="code">

<span class="id" title="keyword">Set</span> <span class="id" title="var">Warnings</span> "-notation-overridden,-parsing,-deprecated-hint-without-locality".<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">PLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">Maps</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Bool.Bool.html#"><span class="id" title="library">Bool.Bool</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.Arith.html#"><span class="id" title="library">Arith.Arith</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.EqNat.html#"><span class="id" title="library">Arith.EqNat</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#"><span class="id" title="library">Arith.PeanoNat</span></a>. <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#Nat"><span class="id" title="module">Nat</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library//Coq.micromega.Lia.html#"><span class="id" title="library">Lia</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">PLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span>   <span class="id" title="library">Imp</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">PLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="HoareAM.html#"><span class="id" title="library">HoareAM</span></a>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">verify_assn</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">unfold</span> <a class="idref" href="HoareAM.html#assert_implies"><span class="id" title="definition">assert_implies</span></a>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="HoareAM.html#ap"><span class="id" title="definition">ap</span></a> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">unfold</span> <a class="idref" href="HoareAM.html#ap<sub>2</sub>"><span class="id" title="definition">ap<sub>2</sub></span></a> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="HoareAM.html#bassertion"><span class="id" title="definition">bassertion</span></a> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">unfold</span> <span class="id" title="definition">beval</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">unfold</span> <span class="id" title="definition">aeval</span> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="HoareAM.html#assertion_sub"><span class="id" title="definition">assertion_sub</span></a>; <span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="axiom">t_update_eq</span> ||<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="axiom">t_update_neq</span>; [| (<span class="id" title="tactic">intro</span> <span class="id" title="var">X</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">X</span>; <span class="id" title="tactic">fail</span>)]));<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> [<span class="id" title="var">H</span> : <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <span class="id" title="var">_</span> &#x22A2; <span class="id" title="var">_</span>] ⇒ <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Bool.Bool.html#not_true_iff_false"><span class="id" title="lemma">not_true_iff_false</span></a> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Bool.Bool.html#not_false_iff_true"><span class="id" title="lemma">not_false_iff_true</span></a> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Bool.Bool.html#negb_true_iff"><span class="id" title="lemma">negb_true_iff</span></a> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Bool.Bool.html#negb_false_iff"><span class="id" title="lemma">negb_false_iff</span></a> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#Nat.eqb_eq"><span class="id" title="lemma">eqb_eq</span></a> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#Nat.eqb_neq"><span class="id" title="lemma">eqb_neq</span></a> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.Compare_dec.html#leb_iff"><span class="id" title="abbreviation">leb_iff</span></a> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.Compare_dec.html#leb_iff_conv"><span class="id" title="lemma">leb_iff_conv</span></a> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">st</span> : <span class="id" title="definition">state</span> &#x22A2; <span class="id" title="var">_</span>] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H</span> : <span class="id" title="var">st</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span> &#x22A2; <span class="id" title="var">_</span>] ⇒ <span class="id" title="tactic">rewrite</span> → <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H</span> : <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">st</span> <span class="id" title="var">_</span> &#x22A2; <span class="id" title="var">_</span>] ⇒ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>.<br/>
</div>

<div class="doc">
We can <i>derive</i> an assigment rule modulo consequence that is
easier to use since the precondition is any propitions that entails the required
substitution:
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <a id="hoare_asg_conseq'" class="idref" href="#hoare_asg_conseq'"><span class="id" title="lemma">hoare_asg_conseq'</span></a>:   <span class="id" title="keyword">∀</span> <a id="P:1" class="idref" href="#P:1"><span class="id" title="binder">P</span></a> <a id="Q:2" class="idref" href="#Q:2"><span class="id" title="binder">Q</span></a> <a id="X:3" class="idref" href="#X:3"><span class="id" title="binder">X</span></a> <a id="a:4" class="idref" href="#a:4"><span class="id" title="binder">a</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Vcg.html#P:1"><span class="id" title="variable">P</span></a> <a class="idref" href="HoareAM.html#::hoare_spec_scope:x_'-&gt;&gt;'_x"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span></a> <a class="idref" href="Vcg.html#Q:2"><span class="id" title="variable">Q</span></a> <a class="idref" href="HoareAM.html#510fc37417e4aa55210e4cfe35fb96ae"><span class="id" title="notation">[</span></a><a class="idref" href="Vcg.html#X:3"><span class="id" title="variable">X</span></a> <a class="idref" href="HoareAM.html#510fc37417e4aa55210e4cfe35fb96ae"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span></span></a> <a class="idref" href="Vcg.html#a:4"><span class="id" title="variable">a</span></a><a class="idref" href="HoareAM.html#510fc37417e4aa55210e4cfe35fb96ae"><span class="id" title="notation">]</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a><a class="idref" href="Vcg.html#P:1"><span class="id" title="variable">P</span></a><a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a> <a class="idref" href="Vcg.html#X:3"><span class="id" title="variable">X</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="Vcg.html#a:4"><span class="id" title="variable">a</span></a> <a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a><a class="idref" href="Vcg.html#Q:2"><span class="id" title="variable">Q</span></a><a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> .<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="HoareAM.html#hoare_consequence_pre"><span class="id" title="lemma">hoare_consequence_pre</span></a> <span class="id" title="keyword">with</span> (<span class="id" title="var">Q</span> <a class="idref" href="HoareAM.html#510fc37417e4aa55210e4cfe35fb96ae"><span class="id" title="notation">[</span></a><span class="id" title="var">X</span> <a class="idref" href="HoareAM.html#510fc37417e4aa55210e4cfe35fb96ae"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span></span></a> <span class="id" title="var">a</span><a class="idref" href="HoareAM.html#510fc37417e4aa55210e4cfe35fb96ae"><span class="id" title="notation">]</span></a>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="HoareAM.html#hoare_asgn"><span class="id" title="lemma">hoare_asgn</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
A derived rule for <span class="inlinecode"><span class="id" title="var">while</span></span> modulo weakening the postcondition:
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <a id="hoare_while_conseq'" class="idref" href="#hoare_while_conseq'"><span class="id" title="lemma">hoare_while_conseq'</span></a> : <span class="id" title="keyword">∀</span> <a id="P:5" class="idref" href="#P:5"><span class="id" title="binder">P</span></a> <a id="Q:6" class="idref" href="#Q:6"><span class="id" title="binder">Q</span></a>(<a id="b:7" class="idref" href="#b:7"><span class="id" title="binder">b</span></a>:<span class="id" title="inductive">bexp</span>) <a id="c:8" class="idref" href="#c:8"><span class="id" title="binder">c</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a><a class="idref" href="Vcg.html#P:5"><span class="id" title="variable">P</span></a> <a class="idref" href="HoareAM.html#cce4ad113420d0c25c6ce4891bbe5028"><span class="id" title="notation">∧</span></a> <a class="idref" href="Vcg.html#b:7"><span class="id" title="variable">b</span></a><a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a> <a class="idref" href="Vcg.html#c:8"><span class="id" title="variable">c</span></a> <a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a><a class="idref" href="Vcg.html#P:5"><span class="id" title="variable">P</span></a><a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="HoareAM.html#::hoare_spec_scope:x_'-&gt;&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">fun</span> <a id="st:9" class="idref" href="#st:9"><span class="id" title="binder">st</span></a> ⇒ <a class="idref" href="Vcg.html#P:5"><span class="id" title="variable">P</span></a> <a class="idref" href="Vcg.html#st:9"><span class="id" title="variable">st</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">(</span></a><a class="idref" href="HoareAM.html#bassertion"><span class="id" title="definition">bassertion</span></a> <a class="idref" href="Vcg.html#b:7"><span class="id" title="variable">b</span></a> <a class="idref" href="Vcg.html#st:9"><span class="id" title="variable">st</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">)</span></a><a class="idref" href="HoareAM.html#::hoare_spec_scope:x_'-&gt;&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="HoareAM.html#::hoare_spec_scope:x_'-&gt;&gt;'_x"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span></a> <a class="idref" href="Vcg.html#Q:6"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a><a class="idref" href="Vcg.html#P:5"><span class="id" title="variable">P</span></a><a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a> <span class="id" title="notation">while</span> <a class="idref" href="Vcg.html#b:7"><span class="id" title="variable">b</span></a> <span class="id" title="notation">do</span> <a class="idref" href="Vcg.html#c:8"><span class="id" title="variable">c</span></a> <span class="id" title="notation">end</span> <a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a><a class="idref" href="Vcg.html#Q:6"><span class="id" title="variable">Q</span></a><a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">b</span> <span class="id" title="var">C</span> <span class="id" title="var">H</span> <span class="id" title="var">Himp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="HoareAM.html#hoare_consequence_post"><span class="id" title="lemma">hoare_consequence_post</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">apply</span> <a class="idref" href="HoareAM.html#hoare_while"><span class="id" title="lemma">hoare_while</span></a>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <a id="hoare_skip_conseq" class="idref" href="#hoare_skip_conseq"><span class="id" title="lemma">hoare_skip_conseq</span></a> : <span class="id" title="keyword">∀</span> <a id="P:10" class="idref" href="#P:10"><span class="id" title="binder">P</span></a> <a id="Q:11" class="idref" href="#Q:11"><span class="id" title="binder">Q</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Vcg.html#P:10"><span class="id" title="variable">P</span></a> <a class="idref" href="HoareAM.html#::hoare_spec_scope:x_'-&gt;&gt;'_x"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span></a> <a class="idref" href="Vcg.html#Q:11"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a><a class="idref" href="Vcg.html#P:10"><span class="id" title="variable">P</span></a><a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a> <span class="id" title="notation">skip</span> <a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a><a class="idref" href="Vcg.html#Q:11"><span class="id" title="variable">Q</span></a><a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">HPQ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="HoareAM.html#valid_hoare_triple"><span class="id" title="definition">valid_hoare_triple</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> "<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>" <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">st</span> <span class="id" title="var">st'</span> <span class="id" title="var">H</span> <span class="id" title="var">HP</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab97"></a><h1 class="section">Verification Condition Generation</h1>

<div class="paragraph"> </div>

 Consider this set of rules for Hoare Logic:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span> Q[X <span class="nowrap"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span></span> a]</td>
  <td class="infrulenamecol" rowspan="3">
    (hoare_asg_conseq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span style='letter-spacing:-.4em;'>{</span>{P<span style='letter-spacing:-.4em;'>}</span>} X:=a <span style='letter-spacing:-.4em;'>{</span>{Q<span style='letter-spacing:-.4em;'>}</span>}</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span> Q</td>
  <td class="infrulenamecol" rowspan="3">
    (hoare_skip_conseq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span style='letter-spacing:-.4em;'>{</span>{ P <span style='letter-spacing:-.4em;'>}</span>} skip <span style='letter-spacing:-.4em;'>{</span>{ Q <span style='letter-spacing:-.4em;'>}</span>}</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule"><span style='letter-spacing:-.4em;'>{</span>{ P <span style='letter-spacing:-.4em;'>}</span>} c<sub>1</sub> <span style='letter-spacing:-.4em;'>{</span>{ Q <span style='letter-spacing:-.4em;'>}</span>}</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span style='letter-spacing:-.4em;'>{</span>{ Q <span style='letter-spacing:-.4em;'>}</span>} c<sub>2</sub> <span style='letter-spacing:-.4em;'>{</span>{ R <span style='letter-spacing:-.4em;'>}</span>}</td>
  <td class="infrulenamecol" rowspan="3">
    (hoare_seq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span style='letter-spacing:-.4em;'>{</span>{ P <span style='letter-spacing:-.4em;'>}</span>} c<sub>1</sub>;c<sub>2</sub> <span style='letter-spacing:-.4em;'>{</span>{ R <span style='letter-spacing:-.4em;'>}</span>}</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule"><span style='letter-spacing:-.4em;'>{</span>{P /\  b<span style='letter-spacing:-.4em;'>}</span>} c<sub>1</sub> <span style='letter-spacing:-.4em;'>{</span>{Q<span style='letter-spacing:-.4em;'>}</span>}</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span style='letter-spacing:-.4em;'>{</span>{P /\ ~b<span style='letter-spacing:-.4em;'>}</span>} c<sub>2</sub> <span style='letter-spacing:-.4em;'>{</span>{Q<span style='letter-spacing:-.4em;'>}</span>}</td>
  <td class="infrulenamecol" rowspan="3">
    (hoare_if) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span style='letter-spacing:-.4em;'>{</span>{P<span style='letter-spacing:-.4em;'>}</span>} if b then c<sub>1</sub> else c<sub>2</sub> end <span style='letter-spacing:-.4em;'>{</span>{Q<span style='letter-spacing:-.4em;'>}</span>}</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule"><span style='letter-spacing:-.4em;'>{</span>{P /\ b<span style='letter-spacing:-.4em;'>}</span>} c <span style='letter-spacing:-.4em;'>{</span>{P<span style='letter-spacing:-.4em;'>}</span>} (P /\ ~b) <span class="nowrap"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span> Q</td>
  <td class="infrulenamecol" rowspan="3">
    (hoare_while_conseq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span style='letter-spacing:-.4em;'>{</span>{P<span style='letter-spacing:-.4em;'>}</span>} while b do c end <span style='letter-spacing:-.4em;'>{</span>{Q<span style='letter-spacing:-.4em;'>}</span>}</td>
  <td></td>
</tr>
</table></center> 
<div class="paragraph"> </div>

<a id="lab98"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

<ul class="doclist">
<li> We have a <i>syntax</i> directed proof system and each backward rule

</li>
</ul>
application creates new subgoals for the subcommands.  The
construction of the skeleton of this proof tree is completely
automatic.

<div class="paragraph"> </div>

<ul class="doclist">
<li> The consequence rule is built into the derived rules and is not

</li>
</ul>
required anymore. This is crucial: the consequence rule destroys
syntax directedness because it can be applied at any point.

<div class="paragraph"> </div>

<ul class="doclist">
<li> When applying the sequence rule for <span class="inlinecode"><span class="id" title="var">c<sub>1</sub></span></span> <span class="inlinecode">;</span> <span class="inlinecode"><span class="id" title="var">c<sub>2</sub></span></span> <span class="inlinecode"></span> backwards we need to

</li>
</ul>
provide the intermediate assertion that occurs in the premises but not
the conclusion. It turns out that we can compute it by pulling the
final assertion back through <span class="inlinecode"><span class="id" title="var">c<sub>2</sub></span></span>.

<div class="paragraph"> </div>

There are two aspects that cannot be fully automated (or program
verification would be completely automatic, which is impossible):
<i>loop</i> invariants <i>must</i> be supplied explicitly, and the implications between
assertions in the premises of the derived rules must be proved
somehow.

<div class="paragraph"> </div>

In a nutshell, proving triples in Hoare logic amounts to <i>finding
invariants</i> and <i>proving assertions</i>.

<div class="paragraph"> </div>


<div class="paragraph"> </div>

<a id="lab99"></a><h3 class="section"> </h3>
  We aim to reduce provability in Hoare logic to provability in the
assertion language, i.e. Coq in our case. Given a triple <span class="inlinecode">{<span class="id" title="var">P</span>}</span> <span class="inlinecode"><span class="id" title="var">c</span></span> <span class="inlinecode">{<span class="id" title="var">Q</span>}</span>
that we want to prove, we show how to compute an assertion <span class="inlinecode"><span class="id" title="var">A</span></span> from it
such that <span class="inlinecode">{<span class="id" title="var">P</span></span> <span class="inlinecode">}</span> <span class="inlinecode"><span class="id" title="var">c</span></span> <span class="inlinecode">{<span class="id" title="var">Q</span>}</span> is provable iff <span class="inlinecode"><span class="id" title="var">A</span></span> is provable.

<div class="paragraph"> </div>

We call <span class="inlinecode"><span class="id" title="var">A</span></span> a <i>verification condition</i> and the function that computes <span class="inlinecode"><span class="id" title="var">A</span></span>
a verification condition generator or <i>VCG</i>. The advantage of working
with a VCG is that no knowledge of Hoare logic is required.

<div class="paragraph"> </div>

Summary:

<div class="paragraph"> </div>

<ul class="doclist">
<li> <i>annotate</i> the program with assertions meant to hold at certain
  program points

<div class="paragraph"> </div>

  ==&gt; This needs understanding ("eureka") of how the program works

<div class="paragraph"> </div>


</li>
<li> <i>generate</i> a set of logical conditions (VCs) from annotated program

<div class="paragraph"> </div>

  ==&gt; This is automatic

<div class="paragraph"> </div>


</li>
<li> <i>prove</i> the VCs.

<div class="paragraph"> </div>

  ==&gt; This is a matter of theorem proving (undecidable in general).  
</li>
</ul>

<div class="paragraph"> </div>

<a id="lab100"></a><h2 class="section">Annotated commands</h2>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

An annotated command is a command with <i>assertions</i> embedded within
it.  This may vary from <i>full</i> decoration (every command has pre and
post conditions), to more economical ones.

<div class="paragraph"> </div>

 We choose the least invasive: we only annotate <span class="inlinecode"><span class="id" title="var">while</span></span> loops with
 their invariants.

<div class="paragraph"> </div>

Where do we get those invariants? Here, we take the easy way out: the
<i>user</i> will provide them. In general, we can appeal to techniques such
as <i>abstract interpretation, symbolic execution</i> and <i>machine
learning</i> to get suggestions.

<div class="paragraph"> </div>

We introduce a type <span class="inlinecode"><span class="id" title="var">acom</span></span> of annotated commands with the same syntax
as that of type <span class="inlinecode"><span class="id" title="var">com</span></span>, except that WHILE is annotated with an
assertion <span class="inlinecode"><span class="id" title="var">asn</span></span>. We gloss over notations for now.
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <a id="acom" class="idref" href="#acom"><span class="id" title="definition, inductive"><span id="acom_rect" class="id"><span id="acom_ind" class="id"><span id="acom_rec" class="id"><span id="acom_sind" class="id">acom</span></span></span></span></span></a> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <a id="CSkip" class="idref" href="#CSkip"><span class="id" title="constructor">CSkip</span></a><br/>
&nbsp;&nbsp;| <a id="CAsgn" class="idref" href="#CAsgn"><span class="id" title="constructor">CAsgn</span></a> (<a id="x:14" class="idref" href="#x:14"><span class="id" title="binder">x</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>) (<a id="a:15" class="idref" href="#a:15"><span class="id" title="binder">a</span></a> : <span class="id" title="inductive">aexp</span>)<br/>
&nbsp;&nbsp;| <a id="CSeq" class="idref" href="#CSeq"><span class="id" title="constructor">CSeq</span></a> (<a id="c<sub>1</sub>:16" class="idref" href="#c<sub>1</sub>:16"><span class="id" title="binder">c<sub>1</sub></span></a> <a id="c<sub>2</sub>:17" class="idref" href="#c<sub>2</sub>:17"><span class="id" title="binder">c<sub>2</sub></span></a> : <a class="idref" href="Vcg.html#acom:12"><span class="id" title="inductive">acom</span></a>)<br/>
&nbsp;&nbsp;| <a id="CIf" class="idref" href="#CIf"><span class="id" title="constructor">CIf</span></a> (<a id="b:18" class="idref" href="#b:18"><span class="id" title="binder">b</span></a> : <span class="id" title="inductive">bexp</span>) (<a id="c<sub>1</sub>:19" class="idref" href="#c<sub>1</sub>:19"><span class="id" title="binder">c<sub>1</sub></span></a> <a id="c<sub>2</sub>:20" class="idref" href="#c<sub>2</sub>:20"><span class="id" title="binder">c<sub>2</sub></span></a> : <a class="idref" href="Vcg.html#acom:12"><span class="id" title="inductive">acom</span></a>)<br/>
&nbsp;&nbsp;| <a id="CWhile" class="idref" href="#CWhile"><span class="id" title="constructor">CWhile</span></a> (<a id="inv:21" class="idref" href="#inv:21"><span class="id" title="binder">inv</span></a> : <a class="idref" href="HoareAM.html#Assertion"><span class="id" title="definition">Assertion</span></a>)(<a id="b:22" class="idref" href="#b:22"><span class="id" title="binder">b</span></a> : <span class="id" title="inductive">bexp</span>) (<a id="c:23" class="idref" href="#c:23"><span class="id" title="binder">c</span></a> : <a class="idref" href="Vcg.html#acom:12"><span class="id" title="inductive">acom</span></a>).<br/>
</div>

<div class="doc">
<a id="lab101"></a><h3 class="section"> </h3>
 We can <span class="inlinecode"><span class="id" title="var">strip</span></span> invariants from <span class="inlinecode"><span class="id" title="var">acom</span></span> and recover our usual <span class="inlinecode"><span class="id" title="var">com</span></span>mmands:
</div>
<div class="code">
<span class="id" title="keyword">Fixpoint</span>  <a id="strip" class="idref" href="#strip"><span class="id" title="definition">strip</span></a> (<a id="acm:24" class="idref" href="#acm:24"><span class="id" title="binder">acm</span></a> : <a class="idref" href="Vcg.html#acom"><span class="id" title="inductive">acom</span></a>)  : <span class="id" title="inductive">com</span>  :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Vcg.html#acm:24"><span class="id" title="variable">acm</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;|<a class="idref" href="Vcg.html#CSkip"><span class="id" title="constructor">CSkip</span></a> ⇒  <span class="id" title="constructor">Imp.CSkip</span><br/>
&nbsp;&nbsp;|<a class="idref" href="Vcg.html#CAsgn"><span class="id" title="constructor">CAsgn</span></a> <span class="id" title="var">x</span> <span class="id" title="var">e</span> ⇒  <span class="id" title="constructor">Imp.CAsgn</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span><br/>
&nbsp;&nbsp;|<a class="idref" href="Vcg.html#CSeq"><span class="id" title="constructor">CSeq</span></a> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> ⇒  <span class="id" title="constructor">Imp.CSeq</span> (<a class="idref" href="Vcg.html#strip:25"><span class="id" title="definition">strip</span></a> <span class="id" title="var">c<sub>1</sub></span>) (<a class="idref" href="Vcg.html#strip:25"><span class="id" title="definition">strip</span></a> <span class="id" title="var">c<sub>2</sub></span>) <br/>
&nbsp;&nbsp;|<a class="idref" href="Vcg.html#CIf"><span class="id" title="constructor">CIf</span></a> <span class="id" title="var">b</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> ⇒  <span class="id" title="constructor">Imp.CIf</span> <span class="id" title="var">b</span> (<a class="idref" href="Vcg.html#strip:25"><span class="id" title="definition">strip</span></a> <span class="id" title="var">c<sub>1</sub></span>) (<a class="idref" href="Vcg.html#strip:25"><span class="id" title="definition">strip</span></a> <span class="id" title="var">c<sub>2</sub></span>)<br/>
&nbsp;&nbsp;|<a class="idref" href="Vcg.html#CWhile"><span class="id" title="constructor">CWhile</span></a> <span class="id" title="var">_</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> ⇒  <span class="id" title="constructor">Imp.CWhile</span> <span class="id" title="var">b</span> (<a class="idref" href="Vcg.html#strip:25"><span class="id" title="definition">strip</span></a> <span class="id" title="var">c</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<a id="lab102"></a><h3 class="section">Weakest Preconditions</h3>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

The weakest precondition of a command <span class="inlinecode"><span class="id" title="var">c</span></span> with postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span> is an
assertion <span class="inlinecode"><span class="id" title="var">wpre</span></span> <span class="inlinecode"><span class="id" title="var">c</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> s.t:

<div class="paragraph"> </div>

<ul class="doclist">
<li> it is a <i>precondition</i>: p{ wpre c Q } c { Q }] ;

</li>
<li>  it is the weakest: if <span class="inlinecode">{</span> <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">}</span> <span class="inlinecode"><span class="id" title="var">c</span></span> <span class="inlinecode">{</span> <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode">}</span> then <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span> <span class="inlinecode"><span class="id" title="var">wpre</span></span> <span class="inlinecode"><span class="id" title="var">c</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>.

</li>
</ul>

<div class="paragraph"> </div>

Think of <span class="inlinecode"><span class="id" title="var">wpre</span></span> <span class="inlinecode"><span class="id" title="var">c</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> as the assertion described by set of states <span class="inlinecode"><span class="id" title="var">st</span></span>
 such that for all <span class="inlinecode"><span class="id" title="var">st'</span></span>, if <span class="inlinecode"><span class="id" title="var">st</span></span> <span class="inlinecode">=[</span> <span class="inlinecode"><span class="id" title="var">c</span></span> <span class="inlinecode">]=&gt;</span> <span class="inlinecode"><span class="id" title="var">st'</span></span>, then <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class="id" title="var">st'</span></span> holds.

<div class="paragraph"> </div>

<span class="inlinecode"><span class="id" title="var">wpre</span></span> <span class="inlinecode"><span class="id" title="var">c</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> are the necessary hypotheses for program <span class="inlinecode"><span class="id" title="var">c</span></span> to compute a result
that satisfies the postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span>.  Original intuition (Dijkstra,
1975): synthesizing the program c by refinement from its postcondition
<span class="inlinecode"><span class="id" title="var">Q</span></span>. Examples of possible preconditions:

<div class="paragraph"> </div>

<ul class="doclist">
<li> A useless (though valid) Hoare triple:

</li>
</ul>

<div class="paragraph"> </div>

<span class="inlinecode"></span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{</span> <span class="inlinecode"><span class="id" title="var">False</span></span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>}</span>}</span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">Y</span></span> <span class="inlinecode">+</span> <span class="inlinecode">1</span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{</span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">≤</span> <span class="inlinecode">5</span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>}</span>}</span> <span class="inlinecode"></span>

<div class="paragraph"> </div>

<ul class="doclist">
<li> A better precondition:

</li>
</ul>

<div class="paragraph"> </div>

<span class="inlinecode"></span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{</span> <span class="inlinecode"><span class="id" title="var">Y</span></span> <span class="inlinecode">≤</span> <span class="inlinecode">4</span> <span class="inlinecode">∧</span> <span class="inlinecode"><span class="id" title="var">Z</span></span> <span class="inlinecode">=</span> <span class="inlinecode">0</span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>}</span>}</span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">Y</span></span> <span class="inlinecode">+</span> <span class="inlinecode">1</span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{</span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">≤</span> <span class="inlinecode">5</span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>}</span>}</span> <span class="inlinecode"></span>

<div class="paragraph"> </div>

<ul class="doclist">
<li> The <i>best</i>  (weakest) precondition:

</li>
</ul>

<div class="paragraph"> </div>

<span class="inlinecode"></span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{</span> <span class="inlinecode"><span class="id" title="var">Y</span></span> <span class="inlinecode">≤</span> <span class="inlinecode">4</span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>}</span>}</span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">Y</span></span> <span class="inlinecode">+</span> <span class="inlinecode">1</span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{</span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">≤</span> <span class="inlinecode">5</span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>}</span>}</span> <span class="inlinecode"></span>

<div class="paragraph"> </div>

 
<div class="paragraph"> </div>

<a id="lab103"></a><h3 class="section"> </h3>

</div>
<div class="code">
<span class="id" title="keyword">Fixpoint</span>  <a id="wpre" class="idref" href="#wpre"><span class="id" title="definition">wpre</span></a> (<a id="acm:27" class="idref" href="#acm:27"><span class="id" title="binder">acm</span></a> : <a class="idref" href="Vcg.html#acom"><span class="id" title="inductive">acom</span></a>) (<a id="Q:28" class="idref" href="#Q:28"><span class="id" title="binder">Q</span></a>: <a class="idref" href="HoareAM.html#Assertion"><span class="id" title="definition">Assertion</span></a>) : <a class="idref" href="HoareAM.html#Assertion"><span class="id" title="definition">Assertion</span></a>  :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Vcg.html#acm:27"><span class="id" title="variable">acm</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Vcg.html#CSkip"><span class="id" title="constructor">CSkip</span></a> ⇒ <a class="idref" href="Vcg.html#Q:28"><span class="id" title="variable">Q</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Vcg.html#CAsgn"><span class="id" title="constructor">CAsgn</span></a> <span class="id" title="var">x</span> <span class="id" title="var">e</span> ⇒ <span class="id" title="keyword">fun</span> <a id="st:31" class="idref" href="#st:31"><span class="id" title="binder">st</span></a> ⇒ <a class="idref" href="Vcg.html#Q:28"><span class="id" title="variable">Q</span></a> <a class="idref" href="HoareAM.html#510fc37417e4aa55210e4cfe35fb96ae"><span class="id" title="notation">[</span></a><span class="id" title="var">x</span> <a class="idref" href="HoareAM.html#510fc37417e4aa55210e4cfe35fb96ae"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span></span></a> <span class="id" title="var">e</span><a class="idref" href="HoareAM.html#510fc37417e4aa55210e4cfe35fb96ae"><span class="id" title="notation">]</span></a> <a class="idref" href="HoareAM.html#510fc37417e4aa55210e4cfe35fb96ae"><span class="id" title="notation">st</span></a> <br/>
&nbsp;&nbsp;| <a class="idref" href="Vcg.html#CSeq"><span class="id" title="constructor">CSeq</span></a> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> ⇒ <a class="idref" href="Vcg.html#wpre:29"><span class="id" title="definition">wpre</span></a> <span class="id" title="var">c<sub>1</sub></span> (<a class="idref" href="Vcg.html#wpre:29"><span class="id" title="definition">wpre</span></a> <span class="id" title="var">c<sub>2</sub></span> <a class="idref" href="Vcg.html#Q:28"><span class="id" title="variable">Q</span></a>)<br/>
&nbsp;&nbsp;| <a class="idref" href="Vcg.html#CIf"><span class="id" title="constructor">CIf</span></a> <span class="id" title="var">b</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> ⇒ <span class="id" title="keyword">fun</span> <a id="st:32" class="idref" href="#st:32"><span class="id" title="binder">st</span></a> ⇒ <span class="id" title="keyword">if</span> <span class="id" title="definition">beval</span>  <a class="idref" href="Vcg.html#st:32"><span class="id" title="variable">st</span></a> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <a class="idref" href="Vcg.html#wpre:29"><span class="id" title="definition">wpre</span></a> <span class="id" title="var">c<sub>1</sub></span> <a class="idref" href="Vcg.html#Q:28"><span class="id" title="variable">Q</span></a> <a class="idref" href="Vcg.html#st:32"><span class="id" title="variable">st</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="Vcg.html#wpre:29"><span class="id" title="definition">wpre</span></a> <span class="id" title="var">c<sub>2</sub></span> <a class="idref" href="Vcg.html#Q:28"><span class="id" title="variable">Q</span></a> <a class="idref" href="Vcg.html#st:32"><span class="id" title="variable">st</span></a> <br/>
&nbsp;&nbsp;| <a class="idref" href="Vcg.html#CWhile"><span class="id" title="constructor">CWhile</span></a> <span class="id" title="var">inv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">inv</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
In the case of <span class="inlinecode"><span class="id" title="var">while</span></span>, computing <span class="inlinecode"><span class="id" title="var">wpre</span></span> would not terminate. This is
why we have annotated programs and we just return the invariant. 
<div class="paragraph"> </div>

<a id="lab104"></a><h3 class="section">Some examples</h3>

<div class="paragraph"> </div>

 <span class="inlinecode"><span class="id" title="var">wpre</span></span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">:=</span> <span class="inlinecode">1<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">X</span></span> <span class="inlinecode">≤</span> <span class="inlinecode">10<span style='letter-spacing:-.4em;'>}</span>}</span> yields <span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{1</span> <span class="inlinecode">≤</span> <span class="inlinecode">10<span style='letter-spacing:-.4em;'>}</span>}</span> 
</div>
<div class="code">
<span class="id" title="keyword">Compute</span> (<a class="idref" href="Vcg.html#wpre"><span class="id" title="definition">wpre</span></a> (<a class="idref" href="Vcg.html#CAsgn"><span class="id" title="constructor">CAsgn</span></a> <span class="id" title="definition">X</span> 1) (<span class="id" title="keyword">fun</span> <a id="st:33" class="idref" href="#st:33"><span class="id" title="binder">st</span></a> : <span class="id" title="definition">state</span> ⇒ <a class="idref" href="Vcg.html#st:33"><span class="id" title="variable">st</span></a> <span class="id" title="definition">X</span>  <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a<sub>3</sub>"><span class="id" title="notation">≤</span></a> 10 )).<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">wpre</span></span> <span class="inlinecode">(<span class="id" title="var">Z</span>:=</span> <span class="inlinecode"><span class="id" title="var">X</span>;</span> <span class="inlinecode"><span class="id" title="var">X</span>:=<span class="id" title="var">Y</span>;<span class="id" title="var">Y</span></span> <span class="inlinecode">:=<span class="id" title="var">Z</span>)</span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">X</span></span> <span class="inlinecode">≤<span class="id" title="var">Y</span><span style='letter-spacing:-.4em;'>}</span>}</span> yields <span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">Y</span></span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">Z</span><span style='letter-spacing:-.4em;'>}</span>}</span>  
</div>
<div class="code">

<span class="id" title="keyword">Compute</span>  (<a class="idref" href="Vcg.html#wpre"><span class="id" title="definition">wpre</span></a>           (<a class="idref" href="Vcg.html#CSeq"><span class="id" title="constructor">CSeq</span></a> (<a class="idref" href="Vcg.html#CAsgn"><span class="id" title="constructor">CAsgn</span></a> <span class="id" title="definition">Z</span> <span class="id" title="definition">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Vcg.html#CSeq"><span class="id" title="constructor">CSeq</span></a> (<a class="idref" href="Vcg.html#CAsgn"><span class="id" title="constructor">CAsgn</span></a> <span class="id" title="definition">X</span> <span class="id" title="definition">Y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Vcg.html#CAsgn"><span class="id" title="constructor">CAsgn</span></a> <span class="id" title="definition">Y</span> <span class="id" title="definition">Z</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="st:34" class="idref" href="#st:34"><span class="id" title="binder">st</span></a> ⇒ <a class="idref" href="Vcg.html#st:34"><span class="id" title="variable">st</span></a> <span class="id" title="definition">X</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a<sub>3</sub>"><span class="id" title="notation">≤</span></a> <a class="idref" href="Vcg.html#st:34"><span class="id" title="variable">st</span></a> <span class="id" title="definition">Y</span>)).<br/>
</div>

<div class="doc">
<a id="lab105"></a><h3 class="section">VC</h3>
 The function <span class="inlinecode"><span class="id" title="var">vc</span></span> is the actual VCG and returns a <span class="inlinecode"><span class="id" title="keyword">Prop</span></span>, <i>not</i> an assertion
and it is therefore independent of the state, using <span class="inlinecode"><span class="id" title="var">wpre</span></span> in the process.

<div class="paragraph"> </div>

It  generates for non-while constructs only trivial verification conditions (skip, assigment)
or the conjunction of the results of subcomputations (seq, if).
 
</div>
<div class="code">
<span class="id" title="keyword">Fixpoint</span>  <a id="vc" class="idref" href="#vc"><span class="id" title="definition">vc</span></a> (<a id="acm:35" class="idref" href="#acm:35"><span class="id" title="binder">acm</span></a> : <a class="idref" href="Vcg.html#acom"><span class="id" title="inductive">acom</span></a>) (<a id="Q:36" class="idref" href="#Q:36"><span class="id" title="binder">Q</span></a>: <a class="idref" href="HoareAM.html#Assertion"><span class="id" title="definition">Assertion</span></a>) : <span class="id" title="keyword">Prop</span>  :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Vcg.html#acm:35"><span class="id" title="variable">acm</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Vcg.html#CSkip"><span class="id" title="constructor">CSkip</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#True"><span class="id" title="inductive">True</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Vcg.html#CAsgn"><span class="id" title="constructor">CAsgn</span></a> <span class="id" title="var">x</span> <span class="id" title="var">e</span> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#True"><span class="id" title="inductive">True</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Vcg.html#CSeq"><span class="id" title="constructor">CSeq</span></a> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> ⇒ (<a class="idref" href="Vcg.html#vc:37"><span class="id" title="definition">vc</span></a> <span class="id" title="var">c<sub>1</sub></span> (<a class="idref" href="Vcg.html#wpre"><span class="id" title="definition">wpre</span></a> <span class="id" title="var">c<sub>2</sub></span> <a class="idref" href="Vcg.html#Q:36"><span class="id" title="variable">Q</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Vcg.html#vc:37"><span class="id" title="definition">vc</span></a> <span class="id" title="var">c<sub>2</sub></span> <a class="idref" href="Vcg.html#Q:36"><span class="id" title="variable">Q</span></a>)<br/>
&nbsp;&nbsp;| <a class="idref" href="Vcg.html#CIf"><span class="id" title="constructor">CIf</span></a> <span class="id" title="var">_</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> ⇒ <a class="idref" href="Vcg.html#vc:37"><span class="id" title="definition">vc</span></a> <span class="id" title="var">c<sub>1</sub></span> <a class="idref" href="Vcg.html#Q:36"><span class="id" title="variable">Q</span></a>  <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a>  <a class="idref" href="Vcg.html#vc:37"><span class="id" title="definition">vc</span></a> <span class="id" title="var">c<sub>2</sub></span> <a class="idref" href="Vcg.html#Q:36"><span class="id" title="variable">Q</span></a> <br/>
&nbsp;&nbsp;| <a class="idref" href="Vcg.html#CWhile"><span class="id" title="constructor">CWhile</span></a> <span class="id" title="var">inv</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="s:39" class="idref" href="#s:39"><span class="id" title="binder">s</span></a>, <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><span class="id" title="var">inv</span> <a class="idref" href="Vcg.html#s:39"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><span class="id" title="definition">beval</span> <a class="idref" href="Vcg.html#s:39"><span class="id" title="variable">s</span></a> <span class="id" title="var">b</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="notation">true</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Vcg.html#wpre"><span class="id" title="definition">wpre</span></a> <span class="id" title="var">c</span> <span class="id" title="var">inv</span> <a class="idref" href="Vcg.html#s:39"><span class="id" title="variable">s</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><span class="id" title="var">inv</span> <a class="idref" href="Vcg.html#s:39"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <span class="id" title="definition">beval</span> <a class="idref" href="Vcg.html#s:39"><span class="id" title="variable">s</span></a> <span class="id" title="var">b</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="notation">false</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Vcg.html#Q:36"><span class="id" title="variable">Q</span></a> <a class="idref" href="Vcg.html#s:39"><span class="id" title="variable">s</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">))</span></a>  <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Vcg.html#vc:37"><span class="id" title="definition">vc</span></a> <span class="id" title="var">c</span> <span class="id" title="var">inv</span>  <span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<a id="lab106"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

For each <span class="inlinecode">{<span class="id" title="var">inv</span>}</span> <span class="inlinecode"><span class="id" title="var">while</span></span> <span class="inlinecode"><span class="id" title="var">b</span></span> <span class="inlinecode"><span class="id" title="tactic">do</span></span> <span class="inlinecode"><span class="id" title="var">c</span></span> the function <span class="inlinecode"><span class="id" title="var">vc</span></span> builds 3 proof obligations:

<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">inv</span></span> and <span class="inlinecode"><span class="id" title="var">b</span></span> together imply the precondition of the body of the loop, i.e. <span class="inlinecode"><span class="id" title="var">inv</span></span> is an invariant.

<div class="paragraph"> </div>


</li>
<li> At the end of the loop the postcondition holds.

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode"><span class="id" title="var">vc</span></span> <span class="inlinecode"><span class="id" title="var">c</span></span> <span class="inlinecode"><span class="id" title="var">inv</span></span>: recursively applies to any other <span class="inlinecode"><span class="id" title="var">while</span></span> in <span class="inlinecode"><span class="id" title="var">c</span></span>.

<div class="paragraph"> </div>

 
</li>
</ul>

<div class="paragraph"> </div>

<a id="lab107"></a><h3 class="section">Examples</h3>

<div class="paragraph"> </div>

  Consider this "reduce to zero" program:
<br/>
<span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">True</span>}<br/>
<span class="id" title="var">while</span> <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">True</span><span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">X</span> ≠ 0 <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> - 1<br/>
<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">X</span> = 0<span style='letter-spacing:-.4em;'>}</span>}
</span> 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="reduce_to_zero" class="idref" href="#reduce_to_zero"><span class="id" title="definition">reduce_to_zero</span></a> : <a class="idref" href="Vcg.html#acom"><span class="id" title="inductive">acom</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Vcg.html#CWhile"><span class="id" title="constructor">CWhile</span></a> (<span class="id" title="keyword">fun</span> <a id="s:40" class="idref" href="#s:40"><span class="id" title="binder">s</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#True"><span class="id" title="inductive">True</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="constructor">BNeq</span> <span class="id" title="definition">X</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#O"><span class="id" title="constructor">O</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Vcg.html#CAsgn"><span class="id" title="constructor">CAsgn</span></a> <span class="id" title="definition">X</span> (<span class="id" title="constructor">AMinus</span> <span class="id" title="definition">X</span> 1)).<br/>
</div>

<div class="doc">
The post condition: 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="reduce_to_zero_post" class="idref" href="#reduce_to_zero_post"><span class="id" title="definition">reduce_to_zero_post</span></a> := <span class="id" title="keyword">fun</span> <a id="st:41" class="idref" href="#st:41"><span class="id" title="binder">st</span></a> ⇒ <a class="idref" href="Vcg.html#st:41"><span class="id" title="variable">st</span></a> <span class="id" title="definition">X</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 0.<br/>
</div>

<div class="doc">
<a id="lab108"></a><h3 class="section"> </h3>

</div>
<div class="code">
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> (<a class="idref" href="Vcg.html#vc"><span class="id" title="definition">vc</span></a> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Vcg.html#CWhile"><span class="id" title="constructor">CWhile</span></a> (<span class="id" title="keyword">fun</span> <a id="s:42" class="idref" href="#s:42"><span class="id" title="binder">s</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#True"><span class="id" title="inductive">True</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="constructor">BNeq</span> <span class="id" title="definition">X</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#O"><span class="id" title="constructor">O</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Vcg.html#CAsgn"><span class="id" title="constructor">CAsgn</span></a> <span class="id" title="definition">X</span> (<span class="id" title="constructor">AMinus</span> <span class="id" title="definition">X</span> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#O"><span class="id" title="constructor">O</span></a>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="st:43" class="idref" href="#st:43"><span class="id" title="binder">st</span></a> ⇒ <a class="idref" href="Vcg.html#st:43"><span class="id" title="variable">st</span></a> <span class="id" title="definition">X</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 0)).<br/><hr class='doublespaceincode'/>
<span class="comment">(*&nbsp;(forall&nbsp;s&nbsp;:&nbsp;state,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(True&nbsp;/\&nbsp;negb&nbsp;(s&nbsp;X&nbsp;=?&nbsp;0)&nbsp;=&nbsp;true&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((fun&nbsp;_&nbsp;:&nbsp;state&nbsp;=&gt;&nbsp;True)&nbsp;<span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span></span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">-</span> <span class="inlinecode">1</span>)&nbsp;s)&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(True&nbsp;/\&nbsp;negb&nbsp;(s&nbsp;X&nbsp;=?&nbsp;0)&nbsp;=&nbsp;false&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>&nbsp;s&nbsp;X&nbsp;=&nbsp;0))&nbsp;/\&nbsp;True*)</span><br/>
</div>

<div class="doc">
... which is true.
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a id="reduce_to_zero_correct_vgc" class="idref" href="#reduce_to_zero_correct_vgc"><span class="id" title="lemma">reduce_to_zero_correct_vgc</span></a>:<br/>
&nbsp;&nbsp;<a class="idref" href="Vcg.html#vc"><span class="id" title="definition">vc</span></a> <a class="idref" href="Vcg.html#reduce_to_zero"><span class="id" title="definition">reduce_to_zero</span></a> <a class="idref" href="Vcg.html#reduce_to_zero_post"><span class="id" title="definition">reduce_to_zero_post</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Vcg.html#reduce_to_zero"><span class="id" title="definition">reduce_to_zero</span></a>, <a class="idref" href="Vcg.html#reduce_to_zero_post"><span class="id" title="definition">reduce_to_zero_post</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">verify_assn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab109"></a><h2 class="section">Soundness</h2>

<div class="paragraph"> </div>

 Our VCG is <i>sound</i> w.r.t. Hoare logic.
This reduces the question " does <span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P</span></span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>}</span>}</span> <span class="inlinecode"><span class="id" title="var">c</span></span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">Q</span><span style='letter-spacing:-.4em;'>}</span>}</span> hold?"  to the question "is
the verification condition true ?".

<div class="paragraph"> </div>

We can prove, by induction on <span class="inlinecode"><span class="id" title="var">c</span></span>, that if <span class="inlinecode"><span class="id" title="var">vc</span></span> <span class="inlinecode"><span class="id" title="var">c</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span> holds, then
the Hoare triple where the precondition has been <i>computed</i> by <span class="inlinecode"><span class="id" title="var">wpre</span></span> is indeed valid.

<div class="paragraph"> </div>

In other terms, <span class="inlinecode"><span class="id" title="var">vc</span></span> is <i>sufficient</i> for validity
 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="vc_sound" class="idref" href="#vc_sound"><span class="id" title="lemma">vc_sound</span></a>:<span class="id" title="keyword">∀</span> <a id="c:44" class="idref" href="#c:44"><span class="id" title="binder">c</span></a> <a id="Q:45" class="idref" href="#Q:45"><span class="id" title="binder">Q</span></a>, <a class="idref" href="Vcg.html#vc"><span class="id" title="definition">vc</span></a> <a class="idref" href="Vcg.html#c:44"><span class="id" title="variable">c</span></a> <a class="idref" href="Vcg.html#Q:45"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a><a class="idref" href="Vcg.html#wpre"><span class="id" title="definition">wpre</span></a> <a class="idref" href="Vcg.html#c:44"><span class="id" title="variable">c</span></a> <a class="idref" href="Vcg.html#Q:45"><span class="id" title="variable">Q</span></a><a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a> <span class="id" title="notation">(</span><a class="idref" href="Vcg.html#strip"><span class="id" title="definition">strip</span></a> <a class="idref" href="Vcg.html#c:44"><span class="id" title="variable">c</span></a><span class="id" title="notation">)</span> <a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a><a class="idref" href="Vcg.html#Q:45"><span class="id" title="variable">Q</span></a><a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a>.<br/>
<div class="togglescript" id="proofcontrol1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')"><span class="show"></span></div>
<div class="proofscript" id="proof1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')">
<span class="id" title="keyword">Proof</span>.<br/>
<span class="id" title="tactic">induction</span> <span class="id" title="var">c</span>; <span class="id" title="tactic">intros</span>;<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
- <span class="id" title="tactic">apply</span> <a class="idref" href="HoareAM.html#hoare_skip"><span class="id" title="lemma">hoare_skip</span></a>.<br/>
- <span class="id" title="tactic">apply</span> <a class="idref" href="HoareAM.html#hoare_asgn"><span class="id" title="lemma">hoare_asgn</span></a>.<br/>
- <span class="id" title="tactic">eapply</span> <a class="idref" href="HoareAM.html#hoare_seq"><span class="id" title="lemma">hoare_seq</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="comment">(*&nbsp;if&nbsp;*)</span><br/>
- <span class="id" title="tactic">apply</span> <span class="id" title="var">IHc1</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHc2</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">IHc1</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">IHc2</span>.<br/>
<span class="id" title="tactic">apply</span> <a class="idref" href="HoareAM.html#hoare_if"><span class="id" title="lemma">hoare_if</span></a>; <span class="id" title="tactic">unfold</span> <a class="idref" href="HoareAM.html#bassertion"><span class="id" title="definition">bassertion</span></a>.<br/>
&nbsp;+ <span class="id" title="tactic">eapply</span> <a class="idref" href="HoareAM.html#hoare_consequence_pre"><span class="id" title="lemma">hoare_consequence_pre</span></a>. <span class="id" title="var">eassumption</span>.<br/>
&nbsp;<span class="id" title="tactic">unfold</span> "<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>". <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">b</span>); <span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">auto</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;+ <span class="id" title="tactic">eapply</span> <a class="idref" href="HoareAM.html#hoare_consequence_pre"><span class="id" title="lemma">hoare_consequence_pre</span></a>. <span class="id" title="var">eassumption</span>.<br/>
&nbsp;<span class="id" title="tactic">unfold</span> "<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>". <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">b</span>); <span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">auto</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>.<br/>
<span class="comment">(*&nbsp;while&nbsp;*)</span><br/>
- <span class="id" title="tactic">apply</span> <span class="id" title="var">IHc</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="tactic">eapply</span> <a class="idref" href="HoareAM.html#hoare_while_conseq"><span class="id" title="lemma">hoare_while_conseq</span></a>;  <span class="id" title="tactic">unfold</span> <a class="idref" href="HoareAM.html#bassertion"><span class="id" title="definition">bassertion</span></a>.<br/>
&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="HoareAM.html#hoare_consequence_pre"><span class="id" title="lemma">hoare_consequence_pre</span></a>. <span class="id" title="var">eassumption</span>.<br/>
&nbsp;+ <span class="id" title="tactic">unfold</span> "<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>". <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">H</span> <span class="id" title="var">st</span>). <span class="id" title="tactic">auto</span>.<br/>
&nbsp;+  <span class="id" title="tactic">unfold</span> "<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>". <span class="id" title="tactic">intros</span>.<br/>
&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">H</span> <span class="id" title="var">st</span>).<br/>
&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H<sub>3</sub></span>. <span class="id" title="var">verify_assn</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Definition</span> <a id="vcgen" class="idref" href="#vcgen"><span class="id" title="definition">vcgen</span></a> (<a id="P:46" class="idref" href="#P:46"><span class="id" title="binder">P</span></a>: <a class="idref" href="HoareAM.html#Assertion"><span class="id" title="definition">Assertion</span></a>) (<a id="a:47" class="idref" href="#a:47"><span class="id" title="binder">a</span></a>: <a class="idref" href="Vcg.html#acom"><span class="id" title="inductive">acom</span></a>) (<a id="Q:48" class="idref" href="#Q:48"><span class="id" title="binder">Q</span></a>: <a class="idref" href="HoareAM.html#Assertion"><span class="id" title="definition">Assertion</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Vcg.html#P:46"><span class="id" title="variable">P</span></a> <a class="idref" href="HoareAM.html#::hoare_spec_scope:x_'-&gt;&gt;'_x"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span></a> <a class="idref" href="HoareAM.html#::hoare_spec_scope:x_'-&gt;&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="Vcg.html#wpre"><span class="id" title="definition">wpre</span></a> <a class="idref" href="Vcg.html#a:47"><span class="id" title="variable">a</span></a> <a class="idref" href="Vcg.html#Q:48"><span class="id" title="variable">Q</span></a><a class="idref" href="HoareAM.html#::hoare_spec_scope:x_'-&gt;&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Vcg.html#vc"><span class="id" title="definition">vc</span></a> <a class="idref" href="Vcg.html#a:47"><span class="id" title="variable">a</span></a> <a class="idref" href="Vcg.html#Q:48"><span class="id" title="variable">Q</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Corollary</span> <a id="vcg_s" class="idref" href="#vcg_s"><span class="id" title="lemma">vcg_s</span></a>: <span class="id" title="keyword">∀</span> <a id="c:49" class="idref" href="#c:49"><span class="id" title="binder">c</span></a> <a id="P:50" class="idref" href="#P:50"><span class="id" title="binder">P</span></a> <a id="Q:51" class="idref" href="#Q:51"><span class="id" title="binder">Q</span></a>, <br/>
&nbsp;&nbsp;<a class="idref" href="Vcg.html#vcgen"><span class="id" title="definition">vcgen</span></a> <a class="idref" href="Vcg.html#P:50"><span class="id" title="variable">P</span></a> <a class="idref" href="Vcg.html#c:49"><span class="id" title="variable">c</span></a> <a class="idref" href="Vcg.html#Q:51"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a><a class="idref" href="Vcg.html#P:50"><span class="id" title="variable">P</span></a><a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a> <span class="id" title="notation">(</span><a class="idref" href="Vcg.html#strip"><span class="id" title="definition">strip</span></a> <a class="idref" href="Vcg.html#c:49"><span class="id" title="variable">c</span></a><span class="id" title="notation">)</span> <a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a><a class="idref" href="Vcg.html#Q:51"><span class="id" title="variable">Q</span></a><a class="idref" href="HoareAM.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="id" title="tactic">unfold</span> <a class="idref" href="Vcg.html#vcgen"><span class="id" title="definition">vcgen</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> [<span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>].<br/>
<span class="id" title="tactic">eapply</span> <a class="idref" href="HoareAM.html#hoare_consequence_pre"><span class="id" title="lemma">hoare_consequence_pre</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Vcg.html#vc_sound"><span class="id" title="lemma">vc_sound</span></a>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab110"></a><h3 class="section"> </h3>
 How about completeness? Is <span class="inlinecode"><span class="id" title="var">vc</span></span> a necessarily condition?

<div class="paragraph"> </div>

Certainly not: if <span class="inlinecode"><span class="id" title="var">c</span></span> is badly annotated, <span class="inlinecode">{<span class="id" title="var">wpre</span></span> <span class="inlinecode"><span class="id" title="var">c</span></span> <span class="inlinecode"><span class="id" title="var">Q</span>}</span> <span class="inlinecode"><span class="id" title="var">strip</span></span> <span class="inlinecode"><span class="id" title="var">c</span></span> <span class="inlinecode">{<span class="id" title="var">Q</span>}</span> may
be provable but not <span class="inlinecode"><span class="id" title="var">vc</span></span> <span class="inlinecode"><span class="id" title="var">c</span></span> <span class="inlinecode"><span class="id" title="var">Q</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="loopq" class="idref" href="#loopq"><span class="id" title="definition">loopq</span></a> (<a id="Q:52" class="idref" href="#Q:52"><span class="id" title="binder">Q</span></a>: <a class="idref" href="HoareAM.html#Assertion"><span class="id" title="definition">Assertion</span></a>) := (<a class="idref" href="Vcg.html#CWhile"><span class="id" title="constructor">CWhile</span></a> <a class="idref" href="Vcg.html#Q:52"><span class="id" title="variable">Q</span></a> <span class="id" title="constructor">BTrue</span> (<a class="idref" href="Vcg.html#CAsgn"><span class="id" title="constructor">CAsgn</span></a> <span class="id" title="definition">X</span> (<span class="id" title="constructor">ANum</span> 0))) .<br/>
<span class="id" title="keyword">Definition</span> <a id="l" class="idref" href="#l"><span class="id" title="definition">l</span></a> := (<span class="id" title="constructor">Imp.CWhile</span>  <span class="id" title="constructor">BTrue</span> (<span class="id" title="constructor">Imp.CAsgn</span> <span class="id" title="definition">X</span> (<span class="id" title="constructor">ANum</span> 0))).<br/>
</div>

<div class="doc">
This triple is valid 
</div>
<div class="code">
<span class="id" title="keyword">Goal</span>  <a id="Unnamed_thm" class="idref" href="#Unnamed_thm"><span class="id" title="definition">valid_hoare_triple</span></a> <a id="Unnamed_thm" class="idref" href="#Unnamed_thm"><span class="id" title="definition">(</span></a><a id="Unnamed_thm" class="idref" href="#Unnamed_thm"><span class="id" title="definition">fun</span></a> <a id="Unnamed_thm" class="idref" href="#Unnamed_thm"><span class="id" title="binder, definition"><span id="s:53" class="id">s</span></span></a> <a id="Unnamed_thm" class="idref" href="#Unnamed_thm"><span class="id" title="definition">⇒</span></a> <a id="Unnamed_thm" class="idref" href="#Unnamed_thm"><span class="id" title="definition">s</span></a> <a id="Unnamed_thm" class="idref" href="#Unnamed_thm"><span class="id" title="definition">X</span></a> <a id="Unnamed_thm" class="idref" href="#Unnamed_thm"><span class="id" title="definition">=</span></a> <a id="Unnamed_thm" class="idref" href="#Unnamed_thm"><span class="id" title="definition">1)</span></a> <a id="Unnamed_thm" class="idref" href="#Unnamed_thm"><span class="id" title="definition">l</span></a> <a id="Unnamed_thm" class="idref" href="#Unnamed_thm"><span class="id" title="definition">(</span></a><a id="Unnamed_thm" class="idref" href="#Unnamed_thm"><span class="id" title="definition">fun</span></a> <a id="Unnamed_thm" class="idref" href="#Unnamed_thm"><span class="id" title="definition">_</span></a> <a id="Unnamed_thm" class="idref" href="#Unnamed_thm"><span class="id" title="definition">⇒</span></a> <a id="Unnamed_thm" class="idref" href="#Unnamed_thm"><span class="id" title="definition">False</span></a><a id="Unnamed_thm" class="idref" href="#Unnamed_thm"><span class="id" title="definition">)</span></a>.<br/>
<div class="togglescript" id="proofcontrol2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')"><span class="show"></span></div>
<div class="proofscript" id="proof2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="HoareAM.html#hoare_consequence_pre"><span class="id" title="lemma">hoare_consequence_pre</span></a>.<br/>
&nbsp;<span class="id" title="tactic">assert</span> (<a class="idref" href="HoareAM.html#valid_hoare_triple"><span class="id" title="definition">valid_hoare_triple</span></a> (<span class="id" title="keyword">fun</span> <a id="s:54" class="idref" href="#s:54"><span class="id" title="binder"><span id="s:55" class="id">s</span></span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#True"><span class="id" title="inductive">True</span></a>) <a class="idref" href="Vcg.html#l"><span class="id" title="definition">l</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#False"><span class="id" title="inductive">False</span></a>)) <span class="id" title="keyword">as</span> <span class="id" title="var">lp</span>.<br/>
&nbsp;- <span class="id" title="tactic">unfold</span> <a class="idref" href="Vcg.html#l"><span class="id" title="definition">l</span></a>.<br/>
&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="HoareAM.html#hoare_while_conseq"><span class="id" title="lemma">hoare_while_conseq</span></a>.<br/>
&nbsp;&nbsp;-- <span class="id" title="tactic">apply</span> <a class="idref" href="HoareAM.html#hoare_asg_conseq"><span class="id" title="lemma">hoare_asg_conseq</span></a>. <span class="id" title="var">verify_assn</span>.<br/>
&nbsp;&nbsp;-- <span class="id" title="var">verify_assn</span>.<br/>
&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">lp</span>.<br/>
&nbsp;- <span class="id" title="var">verify_assn</span>.<br/>
&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
However, if we annotate it with a wrong loop invariant, it generates
an unprovable verification condition: 
</div>
<div class="code">
<span class="id" title="keyword">Goal</span> <a id="Unnamed_thm0" class="idref" href="#Unnamed_thm0"><span class="id" title="definition">(</span></a><a id="Unnamed_thm0" class="idref" href="#Unnamed_thm0"><span class="id" title="definition">vc</span></a> <a id="Unnamed_thm0" class="idref" href="#Unnamed_thm0"><span class="id" title="definition">(</span></a><a id="Unnamed_thm0" class="idref" href="#Unnamed_thm0"><span class="id" title="definition">loopq</span></a> <a id="Unnamed_thm0" class="idref" href="#Unnamed_thm0"><span class="id" title="definition">(</span></a><a id="Unnamed_thm0" class="idref" href="#Unnamed_thm0"><span class="id" title="definition">fun</span></a> <a id="Unnamed_thm0" class="idref" href="#Unnamed_thm0"><span class="id" title="binder, definition"><span id="s:56" class="id">s</span></span></a> <a id="Unnamed_thm0" class="idref" href="#Unnamed_thm0"><span class="id" title="definition">⇒</span></a> <a id="Unnamed_thm0" class="idref" href="#Unnamed_thm0"><span class="id" title="definition">s</span></a> <a id="Unnamed_thm0" class="idref" href="#Unnamed_thm0"><span class="id" title="definition">X</span></a> <a id="Unnamed_thm0" class="idref" href="#Unnamed_thm0"><span class="id" title="definition">=</span></a> <a id="Unnamed_thm0" class="idref" href="#Unnamed_thm0"><span class="id" title="definition">1))</span></a> <a id="Unnamed_thm0" class="idref" href="#Unnamed_thm0"><span class="id" title="definition">(</span></a><a id="Unnamed_thm0" class="idref" href="#Unnamed_thm0"><span class="id" title="definition">fun</span></a> <a id="Unnamed_thm0" class="idref" href="#Unnamed_thm0"><span class="id" title="definition">_</span></a> <a id="Unnamed_thm0" class="idref" href="#Unnamed_thm0"><span class="id" title="definition">⇒</span></a> <a id="Unnamed_thm0" class="idref" href="#Unnamed_thm0"><span class="id" title="definition">False</span></a><a id="Unnamed_thm0" class="idref" href="#Unnamed_thm0"><span class="id" title="definition">))</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="definition">loop</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">verify_assn</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;false*)</span><br/>
<span class="id" title="var">Admitted</span>.<br/>
</div>

<div class="doc">
We could prove that there is always an annotation that make
completeness work. We won't.  
<div class="paragraph"> </div>

<a id="lab111"></a><h3 class="section">Some additional examples of using the VGC</h3>

<div class="paragraph"> </div>

 For programs w/o loops, verifying the <span class="inlinecode"><span class="id" title="var">vc</span></span> is trivial. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="swap_program" class="idref" href="#swap_program"><span class="id" title="definition">swap_program</span></a> : <a class="idref" href="Vcg.html#acom"><span class="id" title="inductive">acom</span></a>   :=<br/>
&nbsp;&nbsp;<a class="idref" href="Vcg.html#CSeq"><span class="id" title="constructor">CSeq</span></a> (<a class="idref" href="Vcg.html#CAsgn"><span class="id" title="constructor">CAsgn</span></a> <span class="id" title="definition">Z</span> <span class="id" title="definition">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Vcg.html#CSeq"><span class="id" title="constructor">CSeq</span></a> (<a class="idref" href="Vcg.html#CAsgn"><span class="id" title="constructor">CAsgn</span></a> <span class="id" title="definition">X</span> <span class="id" title="definition">Y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Vcg.html#CAsgn"><span class="id" title="constructor">CAsgn</span></a> <span class="id" title="definition">Y</span> <span class="id" title="definition">Z</span>)).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="swap_corr_v<sub>0</sub>" class="idref" href="#swap_corr_v<sub>0</sub>"><span class="id" title="lemma">swap_corr_v<sub>0</sub></span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Vcg.html#vc"><span class="id" title="definition">vc</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Vcg.html#swap_program"><span class="id" title="definition">swap_program</span></a><br/>
&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="st:57" class="idref" href="#st:57"><span class="id" title="binder">st</span></a> ⇒ <a class="idref" href="Vcg.html#st:57"><span class="id" title="variable">st</span></a> <span class="id" title="definition">Y</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a<sub>3</sub>"><span class="id" title="notation">≤</span></a> <a class="idref" href="Vcg.html#st:57"><span class="id" title="variable">st</span></a> <span class="id" title="definition">X</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Vcg.html#swap_program"><span class="id" title="definition">swap_program</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="swap_corr_v" class="idref" href="#swap_corr_v"><span class="id" title="lemma">swap_corr_v</span></a> : <span class="id" title="keyword">∀</span> (<a id="x:58" class="idref" href="#x:58"><span class="id" title="binder">x</span></a> <a id="y:59" class="idref" href="#y:59"><span class="id" title="binder">y</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>), <br/>
&nbsp;&nbsp;<a class="idref" href="Vcg.html#vc"><span class="id" title="definition">vc</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Vcg.html#swap_program"><span class="id" title="definition">swap_program</span></a><br/>
&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <a id="st:60" class="idref" href="#st:60"><span class="id" title="binder">st</span></a> ⇒ <a class="idref" href="Vcg.html#st:60"><span class="id" title="variable">st</span></a> <span class="id" title="definition">X</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Vcg.html#y:59"><span class="id" title="variable">y</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Vcg.html#st:60"><span class="id" title="variable">st</span></a> <span class="id" title="definition">Y</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Vcg.html#x:58"><span class="id" title="variable">x</span></a>).<br/>
&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Vcg.html#swap_program"><span class="id" title="definition">swap_program</span></a>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab112"></a><h3 class="section">Division</h3>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="R" class="idref" href="#R"><span class="id" title="definition">R</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a> := "R".<br/>
<span class="id" title="keyword">Definition</span> <a id="Q" class="idref" href="#Q"><span class="id" title="definition">Q</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a> := "Q".<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="div_inv" class="idref" href="#div_inv"><span class="id" title="definition">div_inv</span></a> : <a class="idref" href="HoareAM.html#Assertion"><span class="id" title="definition">Assertion</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="st:61" class="idref" href="#st:61"><span class="id" title="binder">st</span></a> ⇒ <a class="idref" href="Vcg.html#st:61"><span class="id" title="variable">st</span></a> <span class="id" title="definition">X</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Vcg.html#st:61"><span class="id" title="variable">st</span></a> <a class="idref" href="Vcg.html#R"><span class="id" title="definition">R</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Nat.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Nat.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">(</span></a><a class="idref" href="Vcg.html#st:61"><span class="id" title="variable">st</span></a> <span class="id" title="definition">Y</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Nat.html#ea2ff3d561159081cea6fb2e8113cc<sub>54</sub>"><span class="id" title="notation">×</span></a> <a class="idref" href="Vcg.html#st:61"><span class="id" title="variable">st</span></a> <a class="idref" href="Vcg.html#Q"><span class="id" title="definition">Q</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Nat.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">)</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="div" class="idref" href="#div"><span class="id" title="definition">div</span></a> : <a class="idref" href="Vcg.html#acom"><span class="id" title="inductive">acom</span></a> :=<br/>
&nbsp;<a class="idref" href="Vcg.html#CSeq"><span class="id" title="constructor">CSeq</span></a> (<a class="idref" href="Vcg.html#CAsgn"><span class="id" title="constructor">CAsgn</span></a> <a class="idref" href="Vcg.html#R"><span class="id" title="definition">R</span></a> <span class="id" title="definition">X</span>)<br/>
&nbsp;&nbsp;(<a class="idref" href="Vcg.html#CSeq"><span class="id" title="constructor">CSeq</span></a> (<a class="idref" href="Vcg.html#CAsgn"><span class="id" title="constructor">CAsgn</span></a> <a class="idref" href="Vcg.html#Q"><span class="id" title="definition">Q</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#O"><span class="id" title="constructor">O</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Vcg.html#CWhile"><span class="id" title="constructor">CWhile</span></a> <a class="idref" href="Vcg.html#div_inv"><span class="id" title="definition">div_inv</span></a> (<span class="id" title="constructor">BLe</span> <span class="id" title="definition">Y</span> <a class="idref" href="Vcg.html#R"><span class="id" title="definition">R</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Vcg.html#CSeq"><span class="id" title="constructor">CSeq</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Vcg.html#CAsgn"><span class="id" title="constructor">CAsgn</span></a> <a class="idref" href="Vcg.html#R"><span class="id" title="definition">R</span></a> (<span class="id" title="constructor">AMinus</span> <a class="idref" href="Vcg.html#R"><span class="id" title="definition">R</span></a> <span class="id" title="definition">Y</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Vcg.html#CAsgn"><span class="id" title="constructor">CAsgn</span></a> <a class="idref" href="Vcg.html#Q"><span class="id" title="definition">Q</span></a> (<span class="id" title="constructor">APlus</span> <a class="idref" href="Vcg.html#Q"><span class="id" title="definition">Q</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#O"><span class="id" title="constructor">O</span></a>)))))).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="div_post" class="idref" href="#div_post"><span class="id" title="definition">div_post</span></a> :=<br/>
<span class="id" title="keyword">fun</span> <a id="st:62" class="idref" href="#st:62"><span class="id" title="binder">st</span></a> ⇒ <a class="idref" href="Vcg.html#st:62"><span class="id" title="variable">st</span></a> <a class="idref" href="Vcg.html#R"><span class="id" title="definition">R</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#::nat_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="Vcg.html#st:62"><span class="id" title="variable">st</span></a> <span class="id" title="definition">Y</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Vcg.html#div_inv"><span class="id" title="definition">div_inv</span></a> <a class="idref" href="Vcg.html#st:62"><span class="id" title="variable">st</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="div_correct_vcg" class="idref" href="#div_correct_vcg"><span class="id" title="lemma">div_correct_vcg</span></a>: (<a class="idref" href="Vcg.html#vc"><span class="id" title="definition">vc</span></a> <a class="idref" href="Vcg.html#div"><span class="id" title="definition">div</span></a> <a class="idref" href="Vcg.html#div_post"><span class="id" title="definition">div_post</span></a>).<br/>
<span class="id" title="tactic">unfold</span> <a class="idref" href="Vcg.html#div"><span class="id" title="definition">div</span></a>, <a class="idref" href="Vcg.html#div_post"><span class="id" title="definition">div_post</span></a>,<a class="idref" href="Vcg.html#div_inv"><span class="id" title="definition">div_inv</span></a>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">verify_assn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="comment">(*&nbsp;2024-01-09&nbsp;19:26&nbsp;*)</span><br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>