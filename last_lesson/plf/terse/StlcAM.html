<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>StlcAM</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/plf.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="common/slides.js"></script>
<link href="common/css/slides.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 2: Programming Language Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">StlcAM</h1>


<div class="doc">
<a id="lab186"></a><h1 class="section">Stlc: The Simply Typed Lambda-Calculus</h1>

<div class="paragraph"> </div>

 Our job for this chapter: Formalize a small <i>functional</i>
    language and its type system.

<div class="paragraph"> </div>

    Language: The <i>simply typed lambda-calculus</i> (STLC).
<ul class="doclist">
<li> A small subset of Coq's built-in functional language...

</li>
<li> ...but we'll use different concrete syntax (to avoid
         confusion, and for consistency with standard treatments)

</li>
</ul>

<div class="paragraph"> </div>

    Main new technical challenges:
<ul class="doclist">
<li> variable binding

</li>
<li> substitution 

</li>
</ul>
</div>

<div class="doc">
<a id="lab187"></a><h1 class="section">Overview</h1>

<div class="paragraph"> </div>

 Begin with some set of <i>base types</i> (here, just <span class="inlinecode"><span class="id" title="var">Bool</span></span>)

<div class="paragraph"> </div>

    Add:
<ul class="doclist">
<li> variables

</li>
<li> function abstractions

</li>
<li> application 
</li>
</ul>

<div class="paragraph"> </div>

 Informal concrete syntax: 
<div class="paragraph"> </div>

<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t</span> <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> <span class="id" title="var">x</span>                         (<span class="id" title="var">variable</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| \<span class="id" title="var">x</span>:<span class="id" title="var">T</span>,<span class="id" title="var">t</span>                    (<span class="id" title="var">abstraction</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">t</span> <span class="id" title="var">t</span>                       (<span class="id" title="var">application</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">true</span>                      (<span class="id" title="var">constant</span> <span class="id" title="var">true</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">false</span>                     (<span class="id" title="var">constant</span> <span class="id" title="var">false</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="keyword">if</span> <span class="id" title="var">t</span> <span class="id" title="keyword">then</span> <span class="id" title="var">t</span> <span class="id" title="keyword">else</span> <span class="id" title="var">t</span>        (<span class="id" title="var">conditional</span>)
</span>
<div class="paragraph"> </div>

<a id="lab188"></a><h3 class="section"> </h3>
 Some examples:

<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode">\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">x</span></span>

<div class="paragraph"> </div>

        The identity function for booleans.

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode">(\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> <span class="inlinecode"><span class="id" title="var">true</span></span>

<div class="paragraph"> </div>

        The identity function for booleans, applied to the boolean <span class="inlinecode"><span class="id" title="var">true</span></span>.

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode">\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode"><span class="id" title="var">false</span></span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode"><span class="id" title="var">true</span></span>

<div class="paragraph"> </div>

        The boolean "not" function.

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode">\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">true</span></span>

<div class="paragraph"> </div>

        The constant function that takes every (boolean) argument to
        <span class="inlinecode"><span class="id" title="var">true</span></span>. 
</li>
</ul>
<a id="lab189"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode">\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode">\<span class="id" title="var">y</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">x</span></span>

<div class="paragraph"> </div>

        A two-argument function that takes two booleans and returns
        the first one.  (As in Coq, a two-argument function is really
        a one-argument function whose body is also a one-argument
        function.)

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode">(\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode">\<span class="id" title="var">y</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> <span class="inlinecode"><span class="id" title="var">false</span></span> <span class="inlinecode"><span class="id" title="var">true</span></span>

<div class="paragraph"> </div>

        A two-argument function that takes two booleans and returns
        the first one, applied to the booleans <span class="inlinecode"><span class="id" title="var">false</span></span> and <span class="inlinecode"><span class="id" title="var">true</span></span>.

<div class="paragraph"> </div>

        As in Coq, application associates to the left -- i.e., this
        expression is parsed as <span class="inlinecode">((\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode">\<span class="id" title="var">y</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> <span class="inlinecode"><span class="id" title="var">false</span>)</span> <span class="inlinecode"><span class="id" title="var">true</span></span>.

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode">\<span class="id" title="var">f</span>:<span class="id" title="var">Bool</span>→<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode">(<span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">true</span>)</span>

<div class="paragraph"> </div>

        A higher-order function that takes a <i>function</i> <span class="inlinecode"><span class="id" title="var">f</span></span> (from
        booleans to booleans) as an argument, applies <span class="inlinecode"><span class="id" title="var">f</span></span> to <span class="inlinecode"><span class="id" title="var">true</span></span>,
        and applies <span class="inlinecode"><span class="id" title="var">f</span></span> again to the result.

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode">(\<span class="id" title="var">f</span>:<span class="id" title="var">Bool</span>→<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode">(<span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">true</span>))</span> <span class="inlinecode">(\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">false</span>)</span>

<div class="paragraph"> </div>

        The same higher-order function, applied to the constantly
        <span class="inlinecode"><span class="id" title="var">false</span></span> function. 
</li>
</ul>

<div class="paragraph"> </div>

<a id="lab190"></a><h3 class="section"> </h3>
 Note that <i>all</i> functions are anonymous.

<div class="paragraph"> </div>

    We'll see how to add named function declarations as "syntactic
    sugar" in the next chapter.

<div class="paragraph"> </div>

<a id="lab191"></a><h3 class="section"> </h3>
 The <i>types</i> of the STLC include the base type <span class="inlinecode"><span class="id" title="var">Bool</span></span> for
    boolean values and arrow types for functions.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">T</span> <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> <span class="id" title="var">Bool</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">T</span> → <span class="id" title="var">T</span>
</span>
<div class="paragraph"> </div>

    For example:

<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode">\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">false</span></span> has type <span class="inlinecode"><span class="id" title="var">Bool</span>→<span class="id" title="var">Bool</span></span>

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode">\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">x</span></span> has type <span class="inlinecode"><span class="id" title="var">Bool</span>→<span class="id" title="var">Bool</span></span>

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode">(\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> <span class="inlinecode"><span class="id" title="var">true</span></span> has type <span class="inlinecode"><span class="id" title="var">Bool</span></span>

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode">\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode">\<span class="id" title="var">y</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">x</span></span> has type <span class="inlinecode"><span class="id" title="var">Bool</span>→<span class="id" title="var">Bool</span>→<span class="id" title="var">Bool</span></span>
                              (i.e., <span class="inlinecode"><span class="id" title="var">Bool</span></span> <span class="inlinecode">→</span> <span class="inlinecode">(<span class="id" title="var">Bool</span>→<span class="id" title="var">Bool</span>)</span>)

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode">(\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode">\<span class="id" title="var">y</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> <span class="inlinecode"><span class="id" title="var">false</span></span> has type <span class="inlinecode"><span class="id" title="var">Bool</span>→<span class="id" title="var">Bool</span></span>

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode">(\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode">\<span class="id" title="var">y</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> <span class="inlinecode"><span class="id" title="var">false</span></span> <span class="inlinecode"><span class="id" title="var">true</span></span> has type <span class="inlinecode"><span class="id" title="var">Bool</span></span> 

</li>
</ul>
</div>

<div class="doc">
<a id="lab192"></a><h1 class="section">Syntax</h1>

<div class="paragraph"> </div>

 We next formalize the syntax of the STLC. 
</div>

<div class="doc">
<a id="lab193"></a><h2 class="section">Types</h2>

</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">ty</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">Ty_Bool</span>  : <span class="id" title="var">ty</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Ty_Arrow</span> : <span class="id" title="var">ty</span> → <span class="id" title="var">ty</span> → <span class="id" title="var">ty</span>.<br/>
</div>

<div class="doc">
<a id="lab194"></a><h2 class="section">Terms</h2>

</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">tm</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">tm_var</span>   : <span class="id" title="var">string</span> → <span class="id" title="var">tm</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">tm_app</span>   : <span class="id" title="var">tm</span> → <span class="id" title="var">tm</span> → <span class="id" title="var">tm</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">tm_abs</span>   : <span class="id" title="var">string</span> → <span class="id" title="var">ty</span> → <span class="id" title="var">tm</span> → <span class="id" title="var">tm</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">tm_true</span>  : <span class="id" title="var">tm</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">tm_false</span> : <span class="id" title="var">tm</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">tm_if</span>    : <span class="id" title="var">tm</span> → <span class="id" title="var">tm</span> → <span class="id" title="var">tm</span> → <span class="id" title="var">tm</span>.<br/>
</div>

<div class="doc">
<a id="lab195"></a><h3 class="section"> </h3>

</div>
<div class="code">

<span class="id" title="var">Declare</span> <span class="id" title="var">Custom</span> <span class="id" title="var">Entry</span> <span class="id" title="var">stlc</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;&lt;{ e }&gt;" := <span class="id" title="var">e</span> (<span class="id" title="var">e</span> <span class="id" title="var">custom</span> <span class="id" title="var">stlc</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99).<br/>
<span class="id" title="keyword">Notation</span> &quot;( x )" := <span class="id" title="var">x</span> (<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">stlc</span>, <span class="id" title="var">x</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99).<br/>
<span class="id" title="keyword">Notation</span> &quot;x" := <span class="id" title="var">x</span> (<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">stlc</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">x</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0).<br/>
<span class="id" title="keyword">Notation</span> &quot;S <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> T" := (<span class="id" title="var">Ty_Arrow</span> <span class="id" title="var">S</span> <span class="id" title="var">T</span>) (<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">stlc</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 50, <span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>).<br/>
<span class="id" title="keyword">Notation</span> &quot;x y" := (<span class="id" title="var">tm_app</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) (<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">stlc</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 1, <span class="id" title="tactic">left</span> <span class="id" title="keyword">associativity</span>).<br/>
<span class="id" title="keyword">Notation</span> &quot;\ x : t , y" :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">tm_abs</span> <span class="id" title="var">x</span> <span class="id" title="var">t</span> <span class="id" title="var">y</span>) (<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">stlc</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 90, <span class="id" title="var">x</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t</span> <span class="id" title="var">custom</span> <span class="id" title="var">stlc</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">y</span> <span class="id" title="var">custom</span> <span class="id" title="var">stlc</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">left</span> <span class="id" title="keyword">associativity</span>).<br/>
<span class="id" title="keyword">Coercion</span> <span class="id" title="var">tm_var</span> : <span class="id" title="var">string</span> &gt;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">tm</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> &quot;'Bool'" := <span class="id" title="var">Ty_Bool</span> (<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">stlc</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0).<br/>
<span class="id" title="keyword">Notation</span> &quot;'if' x 'then' y 'else' z" :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">tm_if</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span>) (<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">stlc</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 89,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span> <span class="id" title="var">custom</span> <span class="id" title="var">stlc</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">y</span> <span class="id" title="var">custom</span> <span class="id" title="var">stlc</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">z</span> <span class="id" title="var">custom</span> <span class="id" title="var">stlc</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">left</span> <span class="id" title="keyword">associativity</span>).<br/>
<span class="id" title="keyword">Notation</span> &quot;'true'"  := <span class="id" title="var">true</span> (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 1).<br/>
<span class="id" title="keyword">Notation</span> &quot;'true'"  := <span class="id" title="var">tm_true</span> (<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">stlc</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0).<br/>
<span class="id" title="keyword">Notation</span> &quot;'false'"  := <span class="id" title="var">false</span> (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 1).<br/>
<span class="id" title="keyword">Notation</span> &quot;'false'"  := <span class="id" title="var">tm_false</span> (<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">stlc</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0).<br/>
</div>

<div class="doc">
Now we need some notation magic to set up the concrete syntax, as
    we did in the <span class="inlinecode"><span class="id" title="var">Imp</span></span> chapter... 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">x</span> : <span class="id" title="var">string</span> := "x".<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">y</span> : <span class="id" title="var">string</span> := "y".<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">z</span> : <span class="id" title="var">string</span> := "z".<br/>
<span class="id" title="keyword">Hint Unfold</span> <span class="id" title="var">x</span> : <span class="id" title="var">core</span>.<br/>
<span class="id" title="keyword">Hint Unfold</span> <span class="id" title="var">y</span> : <span class="id" title="var">core</span>.<br/>
<span class="id" title="keyword">Hint Unfold</span> <span class="id" title="var">z</span> : <span class="id" title="var">core</span>.<br/>
</div>

<div class="doc">
<a id="lab196"></a><h3 class="section"> </h3>
 Note that an abstraction <span class="inlinecode">\<span class="id" title="var">x</span>:<span class="id" title="var">T</span>,<span class="id" title="var">t</span></span> (formally, <span class="inlinecode"><span class="id" title="var">tm_abs</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">T</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span>) is
    always annotated with the type <span class="inlinecode"><span class="id" title="var">T</span></span> of its parameter, in contrast
    to Coq (and other functional languages like ML, Haskell, etc.),
    which use type inference to fill in missing annotations.  We're
    not considering type inference here. 
<div class="paragraph"> </div>

<a id="lab197"></a><h3 class="section"> </h3>
 Examples... 
</div>
<div class="code">

<span class="id" title="keyword">Notation</span> <span class="id" title="var">idB</span> :=<br/>
&nbsp;&nbsp;&lt;{\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>, <span class="id" title="var">x</span>}&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <span class="id" title="var">idBB</span> :=<br/>
&nbsp;&nbsp;&lt;{\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>→<span class="id" title="var">Bool</span>, <span class="id" title="var">x</span>}&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <span class="id" title="var">idBBBB</span> :=<br/>
&nbsp;&nbsp;&lt;{\<span class="id" title="var">x</span>:((<span class="id" title="var">Bool</span>→<span class="id" title="var">Bool</span>)<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>(<span class="id" title="var">Bool</span>→<span class="id" title="var">Bool</span>)), <span class="id" title="var">x</span>}&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <span class="id" title="var">k</span> := &lt;{\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>, \<span class="id" title="var">y</span>:<span class="id" title="var">Bool</span>, <span class="id" title="var">x</span>}&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <span class="id" title="var">notB</span> := &lt;{\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>, <span class="id" title="keyword">if</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> <span class="id" title="var">false</span> <span class="id" title="keyword">else</span> <span class="id" title="var">true</span>}&gt;.<br/>
</div>

<div class="doc">
<a id="lab198"></a><h1 class="section">Operational Semantics</h1>

<div class="paragraph"> </div>

 To define the small-step semantics of STLC terms...

<div class="paragraph"> </div>

<ul class="doclist">
<li> We begin by defining the set of values.

<div class="paragraph"> </div>


</li>
<li> Next, we define <i>free variables</i> and <i>substitution</i>.  These are
      used in the reduction rule for application expressions.

<div class="paragraph"> </div>


</li>
<li> Finally, we give the small-step relation itself.

</li>
</ul>

</div>

<div class="doc">
<a id="lab199"></a><h2 class="section">Values</h2>

<div class="paragraph"> </div>

 To define the values of the STLC, we have a few cases to consider.

<div class="paragraph"> </div>

    First, for the boolean part of the language, the situation is
    clear: <span class="inlinecode"><span class="id" title="var">true</span></span> and <span class="inlinecode"><span class="id" title="var">false</span></span> are the only values.  An <span class="inlinecode"><span class="id" title="keyword">if</span></span> expression
    is never a value. 
<div class="paragraph"> </div>

 Second, an application is not a value: it represents a function
    being invoked on some argument, which clearly still has work left
    to do. 
<div class="paragraph"> </div>

<a id="lab200"></a><h3 class="section"> </h3>
 Third, for abstractions, we have a choice:

<div class="paragraph"> </div>

<ul class="doclist">
<li> We can say that <span class="inlinecode">\<span class="id" title="var">x</span>:<span class="id" title="var">T</span>,</span> <span class="inlinecode"><span class="id" title="var">t</span></span> is a value only when <span class="inlinecode"><span class="id" title="var">t</span></span> is a
        value -- i.e., only if the function's body has been
        reduced (as much as it can be without knowing what argument it
        is going to be applied to).

<div class="paragraph"> </div>


</li>
<li> Or we can say that <span class="inlinecode">\<span class="id" title="var">x</span>:<span class="id" title="var">T</span>,</span> <span class="inlinecode"><span class="id" title="var">t</span></span> is always a value, no matter
        whether <span class="inlinecode"><span class="id" title="var">t</span></span> is one or not -- in other words, we can say that
        reduction stops at abstractions.

</li>
</ul>

<div class="paragraph"> </div>

    Our usual way of evaluating expressions in Gallina makes the first
    choice -- for example,
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Compute</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span>:<span class="id" title="var">bool</span> ⇒ 3 + 4)
</span>    yields:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span>:<span class="id" title="var">bool</span> ⇒ 7
</span>    Most real-world functional programming languages make the second
    choice -- reduction of a function's body only begins when the
    function is actually applied to an argument.  We also make the
    second choice here. 
<div class="paragraph"> </div>

<a id="lab201"></a><h3 class="section"> </h3>

</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">value</span> : <span class="id" title="var">tm</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">v_abs</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">T<sub>2</sub></span> <span class="id" title="var">t<sub>1</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">value</span> &lt;{\<span class="id" title="var">x</span>:<span class="id" title="var">T<sub>2</sub></span>, <span class="id" title="var">t<sub>1</sub></span>}&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">v_true</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">value</span> &lt;{<span class="id" title="var">true</span>}&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">v_false</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">value</span> &lt;{<span class="id" title="var">false</span>}&gt;.<br/>
</div>

<div class="doc">
<a id="lab202"></a><h2 class="section">STLC Programs</h2>

<div class="paragraph"> </div>

 Finally, we must consider what constitutes a <i>complete</i> program.

<div class="paragraph"> </div>

    Intuitively, a "complete program" must not refer to any undefined
    variables.  We'll see shortly how to define the <i>free</i> variables
    in a STLC term.  A complete program is <i>closed</i> -- that is, it
    contains no free variables.

<div class="paragraph"> </div>

    (Conversely, a term with free variables is often called an <i>open
    term</i>.) 
<div class="paragraph"> </div>

 Having made the choice not to reduce under abstractions, we don't
    need to worry about whether variables are values, since we'll
    always be reducing programs "from the outside in," and that means
    the <span class="inlinecode"><span class="id" title="var">step</span></span> relation will always be working with closed terms.  
</div>

<div class="doc">
<a id="lab203"></a><h2 class="section">Substitution</h2>

<div class="paragraph"> </div>

 Now we come to the heart of the STLC: the operation of
    substituting one term for a variable in another term.  This
    operation is used below to define the operational semantics of
    function application, where we will need to substitute the
    argument term for the function parameter in the function's body.
    For example, we reduce
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>, <span class="id" title="keyword">if</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> <span class="id" title="var">true</span> <span class="id" title="keyword">else</span> <span class="id" title="var">x</span>) <span class="id" title="var">false</span>
</span>    to
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">false</span> <span class="id" title="keyword">then</span> <span class="id" title="var">true</span> <span class="id" title="keyword">else</span> <span class="id" title="var">false</span>
</span>    by substituting <span class="inlinecode"><span class="id" title="var">false</span></span> for the parameter <span class="inlinecode"><span class="id" title="var">x</span></span> in the body of the
    function.

<div class="paragraph"> </div>

    In general, we need to be able to substitute some given term <span class="inlinecode"><span class="id" title="var">s</span></span>
    for occurrences of some variable <span class="inlinecode"><span class="id" title="var">x</span></span> in another term <span class="inlinecode"><span class="id" title="var">t</span></span>.  In
    informal discussions, this is usually written <span class="inlinecode"></span> <span class="inlinecode">[<span class="id" title="var">x</span>:=<span class="id" title="var">s</span>]<span class="id" title="var">t</span></span> <span class="inlinecode"></span> and
    pronounced "substitute <span class="inlinecode"><span class="id" title="var">s</span></span> for <span class="inlinecode"><span class="id" title="var">x</span></span> in <span class="inlinecode"><span class="id" title="var">t</span></span>." 
<div class="paragraph"> </div>

<a id="lab204"></a><h3 class="section"> </h3>
 Here are some examples:

<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode">[<span class="id" title="var">x</span>:=<span class="id" title="var">true</span>]</span> <span class="inlinecode">(<span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode"><span class="id" title="var">false</span>)</span>
           yields <span class="inlinecode"><span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">true</span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode"><span class="id" title="var">true</span></span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode"><span class="id" title="var">false</span></span>

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode">[<span class="id" title="var">x</span>:=<span class="id" title="var">true</span>]</span> <span class="inlinecode"><span class="id" title="var">x</span></span> yields <span class="inlinecode"><span class="id" title="var">true</span></span>

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode">[<span class="id" title="var">x</span>:=<span class="id" title="var">true</span>]</span> <span class="inlinecode">(<span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode"><span class="id" title="var">y</span>)</span> yields <span class="inlinecode"><span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">true</span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode"><span class="id" title="var">true</span></span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span>

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode">[<span class="id" title="var">x</span>:=<span class="id" title="var">true</span>]</span> <span class="inlinecode"><span class="id" title="var">y</span></span> yields <span class="inlinecode"><span class="id" title="var">y</span></span>

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode">[<span class="id" title="var">x</span>:=<span class="id" title="var">true</span>]</span> <span class="inlinecode"><span class="id" title="var">false</span></span> yields <span class="inlinecode"><span class="id" title="var">false</span></span> (vacuous substitution)

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode">[<span class="id" title="var">x</span>:=<span class="id" title="var">true</span>]</span> <span class="inlinecode">(\<span class="id" title="var">y</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode"><span class="id" title="var">false</span>)</span>
           yields <span class="inlinecode">\<span class="id" title="var">y</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode"><span class="id" title="var">true</span></span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode"><span class="id" title="var">false</span></span>

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode">[<span class="id" title="var">x</span>:=<span class="id" title="var">true</span>]</span> <span class="inlinecode">(\<span class="id" title="var">y</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> yields <span class="inlinecode">\<span class="id" title="var">y</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">true</span></span>

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode">[<span class="id" title="var">x</span>:=<span class="id" title="var">true</span>]</span> <span class="inlinecode">(\<span class="id" title="var">y</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">y</span>)</span> yields <span class="inlinecode">\<span class="id" title="var">y</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">y</span></span>

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode">[<span class="id" title="var">x</span>:=<span class="id" title="var">true</span>]</span> <span class="inlinecode">(\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> yields <span class="inlinecode">\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">x</span></span>

</li>
</ul>

<div class="paragraph"> </div>

    The last example is very important: substituting <span class="inlinecode"><span class="id" title="var">x</span></span> with <span class="inlinecode"><span class="id" title="var">true</span></span> in
    <span class="inlinecode">\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">x</span></span> does <i>not</i> yield <span class="inlinecode">\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">true</span></span>!  The reason for
    this is that the <span class="inlinecode"><span class="id" title="var">x</span></span> in the body of <span class="inlinecode">\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">x</span></span> is <i>bound</i> by the
    abstraction: it is a new, local name that happens to be
    spelled the same as some global name <span class="inlinecode"><span class="id" title="var">x</span></span>. 
<div class="paragraph"> </div>

<a id="lab205"></a><h3 class="section"> </h3>
 Here is the definition, informally...
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">x</span>:=<span class="id" title="var">s</span>]<span class="id" title="var">x</span>               = <span class="id" title="var">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">x</span>:=<span class="id" title="var">s</span>]<span class="id" title="var">y</span>               = <span class="id" title="var">y</span>                     <span class="id" title="keyword">if</span> <span class="id" title="var">x</span> ≠ <span class="id" title="var">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">x</span>:=<span class="id" title="var">s</span>](\<span class="id" title="var">x</span>:<span class="id" title="var">T</span>, <span class="id" title="var">t</span>)       = \<span class="id" title="var">x</span>:<span class="id" title="var">T</span>, <span class="id" title="var">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">x</span>:=<span class="id" title="var">s</span>](\<span class="id" title="var">y</span>:<span class="id" title="var">T</span>, <span class="id" title="var">t</span>)       = \<span class="id" title="var">y</span>:<span class="id" title="var">T</span>, [<span class="id" title="var">x</span>:=<span class="id" title="var">s</span>]<span class="id" title="var">t</span>         <span class="id" title="keyword">if</span> <span class="id" title="var">x</span> ≠ <span class="id" title="var">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">x</span>:=<span class="id" title="var">s</span>](<span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>)         = ([<span class="id" title="var">x</span>:=<span class="id" title="var">s</span>]<span class="id" title="var">t<sub>1</sub></span>) ([<span class="id" title="var">x</span>:=<span class="id" title="var">s</span>]<span class="id" title="var">t<sub>2</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">x</span>:=<span class="id" title="var">s</span>]<span class="id" title="var">true</span>            = <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">x</span>:=<span class="id" title="var">s</span>]<span class="id" title="var">false</span>           = <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">x</span>:=<span class="id" title="var">s</span>](<span class="id" title="keyword">if</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">t<sub>3</sub></span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> [<span class="id" title="var">x</span>:=<span class="id" title="var">s</span>]<span class="id" title="var">t<sub>1</sub></span> <span class="id" title="keyword">then</span> [<span class="id" title="var">x</span>:=<span class="id" title="var">s</span>]<span class="id" title="var">t<sub>2</sub></span> <span class="id" title="keyword">else</span> [<span class="id" title="var">x</span>:=<span class="id" title="var">s</span>]<span class="id" title="var">t<sub>3</sub></span>
</span>
<div class="paragraph"> </div>

<a id="lab206"></a><h3 class="section"> </h3>
 ... and formally: 
</div>
<div class="code">
<hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="tactic">subst</span> (<span class="id" title="var">x</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">s</span> : <span class="id" title="var">tm</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">tm</span>) : <span class="id" title="var">tm</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">tm_var</span> <span class="id" title="var">y</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">String.eqb</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="keyword">then</span> <span class="id" title="var">s</span> <span class="id" title="keyword">else</span> <span class="id" title="var">t</span><br/>
&nbsp;&nbsp;| &lt;{\<span class="id" title="var">y</span>:<span class="id" title="var">T</span>, <span class="id" title="var">t<sub>1</sub></span>}&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">String.eqb</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="keyword">then</span> <span class="id" title="var">t</span> <span class="id" title="keyword">else</span> &lt;{\<span class="id" title="var">y</span>:<span class="id" title="var">T</span>, [<span class="id" title="var">x</span>:=<span class="id" title="var">s</span>] <span class="id" title="var">t<sub>1</sub></span>}&gt;<br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>}&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{([<span class="id" title="var">x</span>:=<span class="id" title="var">s</span>] <span class="id" title="var">t<sub>1</sub></span>) ([<span class="id" title="var">x</span>:=<span class="id" title="var">s</span>] <span class="id" title="var">t<sub>2</sub></span>)}&gt;<br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="var">true</span>}&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{<span class="id" title="var">true</span>}&gt;<br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="var">false</span>}&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{<span class="id" title="var">false</span>}&gt;<br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="keyword">if</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">t<sub>3</sub></span>}&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{<span class="id" title="keyword">if</span> ([<span class="id" title="var">x</span>:=<span class="id" title="var">s</span>] <span class="id" title="var">t<sub>1</sub></span>) <span class="id" title="keyword">then</span> ([<span class="id" title="var">x</span>:=<span class="id" title="var">s</span>] <span class="id" title="var">t<sub>2</sub></span>) <span class="id" title="keyword">else</span> ([<span class="id" title="var">x</span>:=<span class="id" title="var">s</span>] <span class="id" title="var">t<sub>3</sub></span>)}&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
<br/>
<span class="id" title="keyword">where</span> &quot;'[' x ':=' s ']' t" := (<span class="id" title="tactic">subst</span> <span class="id" title="var">x</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span>) (<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">stlc</span>).<br/>
</div>

<div class="doc">
<a id="lab207"></a><h3 class="section"> </h3>
 <i>Technical note</i>: Substitution becomes trickier to define if we
    consider the case where <span class="inlinecode"><span class="id" title="var">s</span></span>, the term being substituted for a
    variable in some other term, may itself contain free variables.

<div class="paragraph"> </div>

    Fortunately, since we are only interested here in defining the
    <span class="inlinecode"><span class="id" title="var">step</span></span> relation on <i>closed</i> terms (i.e., terms like <span class="inlinecode">\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">x</span></span>
    that include binders for all of the variables they mention), we
    can sidestep this extra complexity, but it must be dealt with when
    formalizing richer languages. 
<div class="paragraph"> </div>

<a id="lab208"></a><h3 class="section"> </h3>
 For example, using the definition of substitution above to
    substitute the <i>open</i> term
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">s</span> = \<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>, <span class="id" title="var">r</span>
</span>    (where <span class="inlinecode"><span class="id" title="var">r</span></span> is a <i>free</i> reference to some global resource) for
    the free variable <span class="inlinecode"><span class="id" title="var">z</span></span> in the term
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t</span> = \<span class="id" title="var">r</span>:<span class="id" title="var">Bool</span>, <span class="id" title="var">z</span>
</span>    where <span class="inlinecode"><span class="id" title="var">r</span></span> is a bound variable, we would get
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\<span class="id" title="var">r</span>:<span class="id" title="var">Bool</span>, \<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>, <span class="id" title="var">r</span>
</span>    where the free reference to <span class="inlinecode"><span class="id" title="var">r</span></span> in <span class="inlinecode"><span class="id" title="var">s</span></span> has been "captured" by
    the binder at the beginning of <span class="inlinecode"><span class="id" title="var">t</span></span>. 

<div class="paragraph"> </div>

    Why would this be bad?  Because it violates the principle that the
    names of bound variables do not matter.  For example, if we rename
    the bound variable in <span class="inlinecode"><span class="id" title="var">t</span></span>, e.g., let
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t'</span> = \<span class="id" title="var">w</span>:<span class="id" title="var">Bool</span>, <span class="id" title="var">z</span>
</span>    then <span class="inlinecode">[<span class="id" title="var">z</span>:=<span class="id" title="var">s</span>]<span class="id" title="var">t'</span></span> is
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\<span class="id" title="var">w</span>:<span class="id" title="var">Bool</span>, \<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>, <span class="id" title="var">r</span>
</span>    which does not behave the same as the original substitution into t:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">z</span>:=<span class="id" title="var">s</span>]<span class="id" title="var">t</span> = \<span class="id" title="var">r</span>:<span class="id" title="var">Bool</span>, \<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>, <span class="id" title="var">r</span>
</span>    That is, renaming a bound variable in <span class="inlinecode"><span class="id" title="var">t</span></span> changes how <span class="inlinecode"><span class="id" title="var">t</span></span> behaves
    under substitution. 
</div>

<div class="doc">
<a id="lab209"></a><h2 class="section">Reduction</h2>

<div class="paragraph"> </div>

 <center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">value v<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (ST_AppAbs) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">(\x:T<sub>2</sub>,t<sub>1</sub>) v<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [x:=v<sub>2</sub>]t<sub>1</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>1</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_App1) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">t<sub>1</sub> t<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>1</sub>' t<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">value v<sub>1</sub></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">t<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>2</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_App2) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">v<sub>1</sub> t<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> v<sub>1</sub> t<sub>2</sub>'</td>
  <td></td>
</tr>
</table></center> (plus the usual rules for conditionals). 
<div class="paragraph"> </div>

<a id="lab210"></a><h3 class="section"> </h3>
 This is <i>call by value</i> reduction: to reduce an
    application <span class="inlinecode">(<span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span>)</span>,
<ul class="doclist">
<li> first reduce <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> to a
        value (a function)

</li>
<li> then reduce the argument <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> to a value

</li>
<li> then reduce the application itself by substituting <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> for
        the bound variable <span class="inlinecode"><span class="id" title="var">x</span></span> in the body <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>.

</li>
</ul>

<div class="paragraph"> </div>

    The <span class="inlinecode"><span class="id" title="var">ST_AppAbs</span></span> rule is often called <i>beta-reduction</i>. 
<div class="paragraph"> </div>

<a id="lab211"></a><h3 class="section"> </h3>

</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">step</span> : <span class="id" title="var">tm</span> → <span class="id" title="var">tm</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">ST_AppAbs</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">T<sub>2</sub></span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">v<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">value</span> <span class="id" title="var">v<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{(\<span class="id" title="var">x</span>:<span class="id" title="var">T<sub>2</sub></span>, <span class="id" title="var">t<sub>1</sub></span>) <span class="id" title="var">v<sub>2</sub></span>}&gt; <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> &lt;{ [<span class="id" title="var">x</span>:=<span class="id" title="var">v<sub>2</sub></span>]<span class="id" title="var">t<sub>1</sub></span> }&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">ST_App1</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>1</sub>'</span> <span class="id" title="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t<sub>1</sub></span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">t<sub>1</sub>'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{<span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>}&gt; <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> &lt;{<span class="id" title="var">t<sub>1</sub>'</span> <span class="id" title="var">t<sub>2</sub></span>}&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">ST_App2</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">t<sub>2</sub>'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">value</span> <span class="id" title="var">v<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t<sub>2</sub></span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">t<sub>2</sub>'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{<span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>}&gt; <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> &lt;{<span class="id" title="var">v<sub>1</sub></span>  <span class="id" title="var">t<sub>2</sub>'</span>}&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">ST_IfTrue</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{<span class="id" title="keyword">if</span> <span class="id" title="var">true</span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">t<sub>2</sub></span>}&gt; <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">t<sub>1</sub></span><br/>
&nbsp;&nbsp;| <span class="id" title="var">ST_IfFalse</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{<span class="id" title="keyword">if</span> <span class="id" title="var">false</span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">t<sub>2</sub></span>}&gt; <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">t<sub>2</sub></span><br/>
&nbsp;&nbsp;| <span class="id" title="var">ST_If</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>1</sub>'</span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">t<sub>3</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t<sub>1</sub></span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">t<sub>1</sub>'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{<span class="id" title="keyword">if</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">t<sub>3</sub></span>}&gt; <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> &lt;{<span class="id" title="keyword">if</span> <span class="id" title="var">t<sub>1</sub>'</span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">t<sub>3</sub></span>}&gt;<br/>
<br/>
<span class="id" title="keyword">where</span> &quot;t '<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>' t'" := (<span class="id" title="var">step</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span>).<br/><hr class='doublespaceincode'/>
</div>

<div class="doc">
<a id="lab212"></a><h1 class="section">Typing</h1>

<div class="paragraph"> </div>

 Next we consider the typing relation of the STLC. 
</div>

<div class="doc">
<a id="lab213"></a><h2 class="section">Contexts</h2>

<div class="paragraph"> </div>

 <i>Question</i>: What is the type of the term "<span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span>"?

<div class="paragraph"> </div>

    <i>Answer</i>: It depends on the types of <span class="inlinecode"><span class="id" title="var">x</span></span> and <span class="inlinecode"><span class="id" title="var">y</span></span>!

<div class="paragraph"> </div>

    I.e., in order to assign a type to a term, we need to know
    what assumptions we should make about the types of its free
    variables.

<div class="paragraph"> </div>

    This leads us to a three-place <i>typing judgment</i>, informally
    written <span class="inlinecode"><span class="id" title="var">Gamma</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">\<span class="id" title="keyword">in</span></span> <span class="inlinecode"><span class="id" title="var">T</span></span>, where <span class="inlinecode"><span class="id" title="var">Gamma</span></span> is a
    "typing context" -- a mapping from variables to their types. 
<div class="paragraph"> </div>

 Following the usual notation for partial maps, we write <span class="inlinecode">(<span class="id" title="var">X</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span></span>
    <span class="inlinecode"><span class="id" title="var">T</span>,</span> <span class="inlinecode"><span class="id" title="var">Gamma</span>)</span> for "update the partial function <span class="inlinecode"><span class="id" title="var">Gamma</span></span> so that it
    maps <span class="inlinecode"><span class="id" title="var">x</span></span> to <span class="inlinecode"><span class="id" title="var">T</span></span>." 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="keyword">context</span> := <span class="id" title="var">partial_map</span> <span class="id" title="var">ty</span>.<br/>
</div>

<div class="doc">
<a id="lab214"></a><h2 class="section">Typing Relation</h2>

<div class="paragraph"> </div>

 <center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">Gamma x = T<sub>1</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_Var) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">Gamma &#x22A2; x &#x2208; T<sub>1</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">x <span class="nowrap"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span></span> T<sub>2</sub> ; Gamma &#x22A2; t<sub>1</sub> &#x2208; T<sub>1</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_Abs) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">Gamma &#x22A2; \x:T<sub>2</sub>,t<sub>1</sub> &#x2208; T<sub>2</sub><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>T<sub>1</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">Gamma &#x22A2; t<sub>1</sub> &#x2208; T<sub>2</sub><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>T<sub>1</sub></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">Gamma &#x22A2; t<sub>2</sub> &#x2208; T<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_App) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">Gamma &#x22A2; t<sub>1</sub> t<sub>2</sub> &#x2208; T<sub>1</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (T_True) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">Gamma &#x22A2; true &#x2208; Bool</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (T_False) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">Gamma &#x22A2; false &#x2208; Bool</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">Gamma &#x22A2; t<sub>1</sub> &#x2208; Bool&nbsp;&nbsp;&nbsp;&nbsp;Gamma &#x22A2; t<sub>2</sub> &#x2208; T<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;Gamma &#x22A2; t<sub>3</sub> &#x2208; T<sub>1</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_If) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">Gamma &#x22A2; if t<sub>1</sub> then t<sub>2</sub> else t<sub>3</sub> &#x2208; T<sub>1</sub></td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>

    We can read the three-place relation <span class="inlinecode"><span class="id" title="var">Gamma</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">\<span class="id" title="keyword">in</span></span> <span class="inlinecode"><span class="id" title="var">T</span></span> as:
    "under the assumptions in Gamma, the term <span class="inlinecode"><span class="id" title="var">t</span></span> has the type <span class="inlinecode"><span class="id" title="var">T</span></span>." 
</div>

<div class="doc">
<a id="lab215"></a><h2 class="section">Examples</h2>

</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">typing_example_1</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">empty</span> &#x22A2; \<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>, <span class="id" title="var">x</span> \<span class="id" title="keyword">in</span> (<span class="id" title="var">Bool</span> → <span class="id" title="var">Bool</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">T_Abs</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">T_Var</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab216"></a><h3 class="section"> </h3>
 Note that, since we added the <span class="inlinecode"><span class="id" title="var">has_type</span></span> constructors to the hints
    database, <span class="inlinecode"><span class="id" title="tactic">auto</span></span> can actually solve this one immediately. 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">typing_example_1'</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">empty</span> &#x22A2; \<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>, <span class="id" title="var">x</span> \<span class="id" title="keyword">in</span> (<span class="id" title="var">Bool</span> → <span class="id" title="var">Bool</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab217"></a><h3 class="section"> </h3>
 More examples: 
</div>
<div class="code">
<span class="id" title="keyword">Example</span> <span class="id" title="var">typing_example_2</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">empty</span> &#x22A2;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\<span class="id" title="var">y</span>:<span class="id" title="var">Bool</span>→<span class="id" title="var">Bool</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">y</span> (<span class="id" title="var">y</span> <span class="id" title="var">x</span>)) \<span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Bool</span> → (<span class="id" title="var">Bool</span> → <span class="id" title="var">Bool</span>) → <span class="id" title="var">Bool</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">eauto</span> 20. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab218"></a><h3 class="section"> </h3>
 We can also show that some terms are <i>not</i> typable.  For example,
    let's check that there is no typing derivation assigning a type
    to the term <span class="inlinecode">\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode">\<span class="id" title="var">y</span>:<span class="id" title="var">Bool</span>,</span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> -- i.e.,
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;¬<span class="id" title="tactic">∃</span> <span class="id" title="var">T</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span> &#x22A2; \<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>, \<span class="id" title="var">y</span>:<span class="id" title="var">Bool</span>, <span class="id" title="var">x</span> <span class="id" title="var">y</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">T</span>.
</span>
</div>
<div class="code">
<div class="togglescript" id="proofcontrol1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')"><span class="show"></span></div>
<div class="proofscript" id="proof1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')">

<br/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">typing_nonexample_1</span> :<br/>
&nbsp;&nbsp;¬<span class="id" title="tactic">∃</span> <span class="id" title="var">T</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">empty</span> &#x22A2;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\<span class="id" title="var">x</span>:<span class="id" title="var">Bool</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\<span class="id" title="var">y</span>:<span class="id" title="var">Bool</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">x</span> <span class="id" title="var">y</span>) \<span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">T</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hc</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hc</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">T</span> <span class="id" title="var">Hc</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hc</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Hc</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>4</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>4</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>5</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>5</sub></span> <span class="id" title="var">H<sub>4</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Restart</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">sauto</span> <span class="id" title="var">q</span>: <span class="id" title="var">on</span> .<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">STLC</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>