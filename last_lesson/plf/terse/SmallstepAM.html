<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>SmallstepAM</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/plf.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="common/slides.js"></script>
<link href="common/css/slides.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 2: Programming Language Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">SmallstepAM</h1>


<div class="doc">
<a id="lab124"></a><h1 class="section">Smallstep: Small-step Operational Semantics</h1>

</div>

<div class="doc">
<a id="lab125"></a><h2 class="section">Big-step Evaluation</h2>
 Our semantics for Imp is written in the so-called
    "big-step" style...

<div class="paragraph"> </div>

    Evaluation rules take an expression (or command) to a final answer
    "all in one step":
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 + 2 + 3 × 4 ==&gt; 16
</span>
<div class="paragraph"> </div>

  Similarly, Hoare logic uses big-step semantics to talk about the
  relationship between the starting and final state (if any) of a
  program.

<div class="paragraph"> </div>

  But big-step semantics makes it hard to talk about what
  happens <i>along the way</i>...

<div class="paragraph"> </div>

<a id="lab126"></a><h2 class="section">Small-step Evaluation</h2>
 <i>Small-step</i> style: Alternatively, we can show how to "reduce"
    an expression to a simpler form by performing a single step
    of computation:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 + 2 + 3 × 4<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 2 + 2 + 12<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 4 + 12<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 16
</span>    Advantages of the small-step style include:

<div class="paragraph"> </div>

<ul class="doclist">
<li> Finer-grained "abstract machine", closer to real
          implementations

<div class="paragraph"> </div>


</li>
<li> Extends smoothly to concurrent languages and languages
          with other sorts of <i>computational effects</i>.

<div class="paragraph"> </div>


</li>
<li> Separates <i>divergence</i> (nontermination) from
          <i>stuckness</i> (run-time error)

</li>
</ul>

<div class="paragraph"> </div>


</div>

<div class="doc">
<a id="lab127"></a><h1 class="section">A Toy Language</h1>

<div class="paragraph"> </div>

 A minimal fragment: 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">tm</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">C</span> : <span class="id" title="var">nat</span> → <span class="id" title="var">tm</span>         <span class="comment">(*&nbsp;Constant&nbsp;*)</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">P</span> : <span class="id" title="var">tm</span> → <span class="id" title="var">tm</span> → <span class="id" title="var">tm</span>. <span class="comment">(*&nbsp;Plus&nbsp;*)</span><br/>
</div>

<div class="doc">
Big-step evaluation as a function 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">evalF</span> (<span class="id" title="var">t</span> : <span class="id" title="var">tm</span>) : <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">C</span> <span class="id" title="var">n</span> ⇒ <span class="id" title="var">n</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">P</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> ⇒ <span class="id" title="var">evalF</span> <span class="id" title="var">t<sub>1</sub></span> + <span class="id" title="var">evalF</span> <span class="id" title="var">t<sub>2</sub></span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<a id="lab128"></a><h3 class="section">Big-step evaluation as a relation</h3>

<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (E_Const) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">C n ==> n</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>1</sub> ==> v<sub>1</sub></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">t<sub>2</sub> ==> v<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (E_Plus) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P t<sub>1</sub> t<sub>2</sub> ==> v<sub>1</sub> + v<sub>2</sub></td>
  <td></td>
</tr>
</table></center>
</div>
<div class="code">
<hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="tactic">eval</span> : <span class="id" title="var">tm</span> → <span class="id" title="var">nat</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">E_Const</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">C</span> <span class="id" title="var">n</span> ==&gt; <span class="id" title="var">n</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">E_Plus</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">v<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t<sub>1</sub></span> ==&gt; <span class="id" title="var">v<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t<sub>2</sub></span> ==&gt; <span class="id" title="var">v<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> ==&gt; (<span class="id" title="var">v<sub>1</sub></span> + <span class="id" title="var">v<sub>2</sub></span>)<br/>
<br/><hr class='doublespaceincode'/>
</div>

<div class="doc">
<a id="lab129"></a><h3 class="section">Small-step evaluation relation</h3>
 <center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_PlusConstConst) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P (C v<sub>1</sub>) (C v<sub>2</sub>) <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> C (v<sub>1</sub> + v<sub>2</sub>)</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>1</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Plus1) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P t<sub>1</sub> t<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> P t<sub>1</sub>' t<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>2</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Plus2) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P (C v<sub>1</sub>) t<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> P (C v<sub>1</sub>) t<sub>2</sub>'</td>
  <td></td>
</tr>
</table></center> Notice:

<div class="paragraph"> </div>

<ul class="doclist">
<li> each step reduces the <i>leftmost</i> <span class="inlinecode"><span class="id" title="var">P</span></span> node that is ready to go

<div class="paragraph"> </div>

<ul class="doclist">
<li> first rule tells how to rewrite this node

<div class="paragraph"> </div>


</li>
<li> second and third rules tell where to find it

<div class="paragraph"> </div>


</li>
</ul>

</li>
<li> constants are not related to anything (i.e., they do not step
         to anything)

</li>
</ul>
<a id="lab130"></a><h3 class="section">Small-step evaluation in Coq</h3>

</div>
<div class="code">
<hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">step</span> : <span class="id" title="var">tm</span> → <span class="id" title="var">tm</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">ST_PlusConstConst</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">v<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> (<span class="id" title="var">C</span> <span class="id" title="var">v<sub>1</sub></span>) (<span class="id" title="var">C</span> <span class="id" title="var">v<sub>2</sub></span>) <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">C</span> (<span class="id" title="var">v<sub>1</sub></span> + <span class="id" title="var">v<sub>2</sub></span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">ST_Plus1</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>1</sub>'</span> <span class="id" title="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t<sub>1</sub></span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">t<sub>1</sub>'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">P</span> <span class="id" title="var">t<sub>1</sub>'</span> <span class="id" title="var">t<sub>2</sub></span><br/>
&nbsp;&nbsp;| <span class="id" title="var">ST_Plus2</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">t<sub>2</sub>'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t<sub>2</sub></span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">t<sub>2</sub>'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> (<span class="id" title="var">C</span> <span class="id" title="var">v<sub>1</sub></span>) <span class="id" title="var">t<sub>2</sub></span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">P</span> (<span class="id" title="var">C</span> <span class="id" title="var">v<sub>1</sub></span>) <span class="id" title="var">t<sub>2</sub>'</span><br/>
<br/>
</div>

<div class="doc">
<a id="lab131"></a><h3 class="section">Examples</h3>

<div class="paragraph"> </div>

 If <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> can take a step to <span class="inlinecode"><span class="id" title="var">t<sub>1</sub>'</span></span>, then <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> steps
    to <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub>'</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>: 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">test_step_1</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> (<span class="id" title="var">C</span> 1) (<span class="id" title="var">C</span> 3))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> (<span class="id" title="var">C</span> 2) (<span class="id" title="var">C</span> 4))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">C</span> 4)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> (<span class="id" title="var">C</span> 2) (<span class="id" title="var">C</span> 4)).<br/>
<div class="togglescript" id="proofcontrol1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')"><span class="show"></span></div>
<div class="proofscript" id="proof1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ST_Plus1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">ST_PlusConstConst</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab132"></a><h1 class="section">Relations</h1>

<div class="paragraph"> </div>

 A <i>binary relation</i> on a set <span class="inlinecode"><span class="id" title="var">X</span></span> is a family of propositions
    parameterized by two elements of <span class="inlinecode"><span class="id" title="var">X</span></span> -- i.e., a proposition about
    pairs of elements of <span class="inlinecode"><span class="id" title="var">X</span></span>.  
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">relation</span> (<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>) := <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>.<br/>
</div>

<div class="doc">
The step relation <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> is an example of a relation on <span class="inlinecode"><span class="id" title="var">tm</span></span>. 
<div class="paragraph"> </div>

<a id="lab133"></a><h3 class="section">Determinism</h3>

<div class="paragraph"> </div>

 One simple property of the <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> relation is that, like the
    big-step evaluation relation for Imp, it is <i>deterministic</i>.

<div class="paragraph"> </div>

    <i>Theorem</i>: For each <span class="inlinecode"><span class="id" title="var">t</span></span>, there is at most one <span class="inlinecode"><span class="id" title="var">t'</span></span> such that <span class="inlinecode"><span class="id" title="var">t</span></span>
    steps to <span class="inlinecode"><span class="id" title="var">t'</span></span> (<span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">t'</span></span> is provable). 
<div class="paragraph"> </div>

 Formally: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">deterministic</span> {<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">R</span> : <span class="id" title="var">relation</span> <span class="id" title="var">X</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">y<sub>1</sub></span>  : <span class="id" title="var">X</span>, <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y<sub>1</sub></span> → <span class="id" title="keyword">∀</span> <span class="id" title="var">y<sub>2</sub></span>, <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y<sub>2</sub></span> → <span class="id" title="var">y<sub>1</sub></span> = <span class="id" title="var">y<sub>2</sub></span>.<br/><hr class='doublespaceincode'/>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">step_deterministic</span>:<br/>
&nbsp;&nbsp;<span class="id" title="var">deterministic</span> <span class="id" title="var">step</span>.<br/>
</div>

<div class="doc">
<a id="lab134"></a><h3 class="section"> </h3>

</div>
<div class="code">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">deterministic</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y<sub>1</sub></span>  <span class="id" title="var">Hy<sub>1</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Hy<sub>1</sub></span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">y<sub>2</sub></span> <span class="id" title="var">Hy<sub>2</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;ST_PlusConstConst&nbsp;*)</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hy<sub>2</sub></span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;ST_PlusConstConst&nbsp;*)</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;ST_Plus1&nbsp;*)</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>2</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;ST_Plus2&nbsp;*)</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>2</sub></span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ST_Plus1&nbsp;*)</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hy<sub>2</sub></span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;ST_PlusConstConst&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hy<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;ST_Plus1&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHHy1</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;ST_Plus2&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hy<sub>1</sub></span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ST_Plus2&nbsp;*)</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hy<sub>2</sub></span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;ST_PlusConstConst&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hy<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;ST_Plus1&nbsp;*)</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>2</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;ST_Plus2&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHHy1</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>

<br/><hr class='doublespaceincode'/>
</div>

<div class="doc">
<a id="lab135"></a><h3 class="section"> </h3>
 The proof of the previous theorem can now be simplified if we use <span class="inlinecode"><span class="id" title="var">sauto</span></span> 
</div>
<div class="code">
<hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">step_deterministic_alt</span>: <span class="id" title="var">deterministic</span> <span class="id" title="var">step</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y<sub>1</sub></span>  <span class="id" title="var">Hy<sub>1</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Hy<sub>1</sub></span>; <span class="id" title="var">sauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
</div>

<div class="doc">
<a id="lab136"></a><h2 class="section">Values</h2>

<div class="paragraph"> </div>

 It can be useful to think of the <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> relation as defining an
    <i>abstract machine</i>:

<div class="paragraph"> </div>

<ul class="doclist">
<li> At any moment, the <i>state</i> of the machine is a term.

<div class="paragraph"> </div>


</li>
<li> A <i>step</i> of the machine is an atomic unit of computation --
        here, a single "add" operation.

<div class="paragraph"> </div>


</li>
<li> The <i>halting states</i> of the machine are ones where there is no
        more computation to be done. 
</li>
</ul>
<a id="lab137"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 We can then <i>execute</i> a term <span class="inlinecode"><span class="id" title="var">t</span></span> as follows:

<div class="paragraph"> </div>

<ul class="doclist">
<li> Take <span class="inlinecode"><span class="id" title="var">t</span></span> as the starting state of the machine.

<div class="paragraph"> </div>


</li>
<li> Repeatedly use the <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> relation to find a sequence of
        machine states, starting with <span class="inlinecode"><span class="id" title="var">t</span></span>, where each state steps to
        the next.

<div class="paragraph"> </div>


</li>
<li> When no more reduction is possible, "read out" the final state
        of the machine as the result of execution. 
</li>
</ul>

<div class="paragraph"> </div>

<a id="lab138"></a><h3 class="section"> </h3>
 Final states of the machine are terms of the form
    <span class="inlinecode"><span class="id" title="var">C</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> for some <span class="inlinecode"><span class="id" title="var">n</span></span>.  We call such terms <i>values</i>. 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">value</span> : <span class="id" title="var">tm</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">v_const</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span>, <span class="id" title="var">value</span> (<span class="id" title="var">C</span> <span class="id" title="var">n</span>).<br/>
</div>

<div class="doc">
This gives a more elegant way of writing the <span class="inlinecode"><span class="id" title="var">ST_Plus2</span></span> rule:  <center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_PlusConstConst) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P (C v<sub>1</sub>) (C v<sub>2</sub>) <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> C (v<sub>1</sub> + v<sub>2</sub>)</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>1</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Plus1) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P t<sub>1</sub> t<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> P t<sub>1</sub>' t<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">value v<sub>1</sub></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">t<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>2</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Plus2) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P v<sub>1</sub> t<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> P v<sub>1</sub> t<sub>2</sub>'</td>
  <td></td>
</tr>
</table></center> 
<div class="paragraph"> </div>

<a id="lab139"></a><h3 class="section"> </h3>
 Again, variable names carry important information:
<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> ranges only over values

</li>
<li> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> range over arbitrary terms

</li>
</ul>

<div class="paragraph"> </div>

    So the <span class="inlinecode"><span class="id" title="var">value</span></span> hypothesis in the last rule is actually redundant
    in the informal presentation: The naming convention tells us where
    to add it when translating the informal rule to Coq.  We'll keep
    it for now, but in later chapters we'll elide it. 
<div class="paragraph"> </div>

<a id="lab140"></a><h3 class="section"> </h3>
  Here are the formal rules: 
</div>
<div class="code">
<hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">step</span> : <span class="id" title="var">tm</span> → <span class="id" title="var">tm</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">ST_PlusConstConst</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">v<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> (<span class="id" title="var">C</span> <span class="id" title="var">v<sub>1</sub></span>) (<span class="id" title="var">C</span> <span class="id" title="var">v<sub>2</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">C</span> (<span class="id" title="var">v<sub>1</sub></span> + <span class="id" title="var">v<sub>2</sub></span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">ST_Plus1</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>1</sub>'</span> <span class="id" title="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t<sub>1</sub></span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">t<sub>1</sub>'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">P</span> <span class="id" title="var">t<sub>1</sub>'</span> <span class="id" title="var">t<sub>2</sub></span><br/>
&nbsp;&nbsp;| <span class="id" title="var">ST_Plus2</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">t<sub>2</sub>'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">value</span> <span class="id" title="var">v<sub>1</sub></span> →                     <span class="comment">(*&nbsp;&lt;---&nbsp;n.b.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t<sub>2</sub></span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">t<sub>2</sub>'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">P</span> <span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub>'</span><br/>
<br/>
</div>

<div class="doc">
<a id="lab141"></a><h2 class="section">Strong Progress and Normal Forms</h2>

<div class="paragraph"> </div>

 <i>Theorem</i> (<i>Strong Progress</i>): If <span class="inlinecode"><span class="id" title="var">t</span></span> is a term, then either <span class="inlinecode"><span class="id" title="var">t</span></span>
    is a value or else there exists a term <span class="inlinecode"><span class="id" title="var">t'</span></span> such that <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">t'</span></span>. 
<div class="paragraph"> </div>

  <i>Proof</i>: By induction on <span class="inlinecode"><span class="id" title="var">t</span></span>.

<div class="paragraph"> </div>

<ul class="doclist">
<li> Suppose <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">C</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span>. Then <span class="inlinecode"><span class="id" title="var">t</span></span> is a value.

<div class="paragraph"> </div>


</li>
<li> Suppose <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>, where (by the IH) <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> either is a value
      or can step to some <span class="inlinecode"><span class="id" title="var">t<sub>1</sub>'</span></span>, and where <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> is either a value or
      can step to some <span class="inlinecode"><span class="id" title="var">t<sub>2</sub>'</span></span>. We must show <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> is either a value
      or steps to some <span class="inlinecode"><span class="id" title="var">t'</span></span>.

<div class="paragraph"> </div>

<ul class="doclist">
<li> If <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> are both values, then <span class="inlinecode"><span class="id" title="var">t</span></span> can take a step, by
        <span class="inlinecode"><span class="id" title="var">ST_PlusConstConst</span></span>.

<div class="paragraph"> </div>


</li>
<li> If <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> is a value and <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> can take a step, then so can <span class="inlinecode"><span class="id" title="var">t</span></span>,
        by <span class="inlinecode"><span class="id" title="var">ST_Plus2</span></span>.

<div class="paragraph"> </div>


</li>
<li> If <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> can take a step, then so can <span class="inlinecode"><span class="id" title="var">t</span></span>, by <span class="inlinecode"><span class="id" title="var">ST_Plus1</span></span>.  <font size=-2>&#9744;</font>

</li>
</ul>

</li>
</ul>

<div class="paragraph"> </div>

   Or, formally: 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">strong_progress</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">value</span> <span class="id" title="var">t</span> ∨ (<span class="id" title="tactic">∃</span> <span class="id" title="var">t'</span>, <span class="id" title="var">t</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">t'</span>).<br/>
<div class="togglescript" id="proofcontrol2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')"><span class="show"></span></div>
<div class="proofscript" id="proof2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;C&nbsp;*)</span> <span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">v_const</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;P&nbsp;*)</span> <span class="id" title="tactic">right</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">IHt1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">IHt1</span> | [<span class="id" title="var">t<sub>1</sub>'</span> <span class="id" title="var">Ht<sub>1</sub></span>] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;l&nbsp;*)</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">IHt2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">IHt2</span> | [<span class="id" title="var">t<sub>2</sub>'</span> <span class="id" title="var">Ht<sub>2</sub></span>] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="comment">(*&nbsp;l&nbsp;*)</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">IHt1</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">IHt2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="var">C</span> (<span class="id" title="var">n</span> + <span class="id" title="var">n<sub>0</sub></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ST_PlusConstConst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="comment">(*&nbsp;r&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="var">P</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub>'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ST_Plus2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHt1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Ht<sub>2</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;r&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="var">P</span> <span class="id" title="var">t<sub>1</sub>'</span> <span class="id" title="var">t<sub>2</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ST_Plus1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Ht<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Restart</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>; <span class="id" title="var">sauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab142"></a><h3 class="section">Normal forms</h3>

<div class="paragraph"> </div>

 The idea of "making progress" can be extended to tell us something
    interesting about values: they are exactly the terms that <i>cannot</i>
    make progress in this sense.

<div class="paragraph"> </div>

    To state this observation formally, let's begin by giving a name
    to "terms that cannot make progress", for an <i>arbitrary</i> relation
    <span class="inlinecode"><span class="id" title="var">R</span></span>.  We'll call them <i>normal forms</i>.  
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">normal_form</span> {<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">R</span> : <span class="id" title="var">relation</span> <span class="id" title="var">X</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">X</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;¬<span class="id" title="tactic">∃</span> <span class="id" title="var">t'</span>, <span class="id" title="var">R</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span>.<br/>
</div>

<div class="doc">
<a id="lab143"></a><h3 class="section">Values vs. normal forms</h3>
 (In this language, though not generally) normal forms and
    values coincide: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">value_is_nf</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">v</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">value</span> <span class="id" title="var">v</span> → <span class="id" title="var">normal_form</span> <span class="id" title="var">step</span> <span class="id" title="var">v</span>.<br/>
<div class="togglescript" id="proofcontrol3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')"><span class="show"></span></div>
<div class="proofscript" id="proof3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">normal_form</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">v</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">contra</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">contra</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">nf_is_value</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">normal_form</span> <span class="id" title="var">step</span> <span class="id" title="var">t</span> → <span class="id" title="var">value</span> <span class="id" title="var">t</span>.<br/>
<div class="togglescript" id="proofcontrol4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')"><span class="show"></span></div>
<div class="proofscript" id="proof4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')">
<span class="id" title="keyword">Proof</span>. <span class="comment">(*&nbsp;a&nbsp;corollary&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">strong_progress</span></span>...&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">normal_form</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">t</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">strong_progress</span> <span class="id" title="var">t</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">G</span> | <span class="id" title="var">G</span>].<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;l&nbsp;*)</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">G</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;r&nbsp;*)</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Restart</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sfirstorder</span> <span class="id" title="var">use</span>: <span class="id" title="var">strong_progress</span> <span class="id" title="tactic">unfold</span>: <span class="id" title="var">normal_form</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Corollary</span> <span class="id" title="var">nf_same_as_value</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">normal_form</span> <span class="id" title="var">step</span> <span class="id" title="var">t</span> ↔ <span class="id" title="var">value</span> <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">nf_is_value</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">value_is_nf</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
Why is this interesting?

<div class="paragraph"> </div>

    Because <span class="inlinecode"><span class="id" title="var">value</span></span> is a syntactic concept -- it is defined by looking
    at the way a term is written -- while <span class="inlinecode"><span class="id" title="var">normal_form</span></span> is a semantic
    one -- it is defined by looking at how the term steps.

<div class="paragraph"> </div>

    It is not obvious that these concepts should characterize the same
    set of terms!  
</div>

<div class="doc">
<a id="lab144"></a><h1 class="section">Multi-Step Reduction</h1>

<div class="paragraph"> </div>

 We can now use the single-step relation and the concept of value
    to formalize an entire <i>execution</i> of the abstract machine.

<div class="paragraph"> </div>

    First, we define a <i>multi-step reduction relation</i> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>&gt;</span><span style='vertical-align:15%;'>*</span></span></span></span> to
    capture the intermediate results of a computation. 
</div>

<div class="doc">
<a id="lab145"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Since we'll want to reuse the idea of multi-step reduction many
    times, let's pause and define it generically.

<div class="paragraph"> </div>

    Given a relation <span class="inlinecode"><span class="id" title="var">R</span></span> (e.g., the step relation <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span>), we define a
    relation <span class="inlinecode"><span class="id" title="var">multi</span></span> <span class="inlinecode"><span class="id" title="var">R</span></span>, called the <i>multi-step closure of <span class="inlinecode"><span class="id" title="var">R</span></span></i> as
    follows. 

<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    multi_refl &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">multi R x x</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">R x y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multi R y z</td>
  <td class="infrulenamecol" rowspan="3">
    multi_step &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">multi R x z</td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>


<div class="paragraph"> </div>

<a id="lab146"></a><h3 class="section"> </h3>

</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">multi</span> {<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">R</span> : <span class="id" title="var">relation</span> <span class="id" title="var">X</span>) : <span class="id" title="var">relation</span> <span class="id" title="var">X</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">multi_refl</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">x</span> : <span class="id" title="var">X</span>), <span class="id" title="var">multi</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">multi_step</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> : <span class="id" title="var">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">multi</span> <span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">multi</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">z</span>.<br/>
</div>

<div class="doc">
<a id="lab147"></a><h3 class="section"> </h3>
 The effect of this definition is that <span class="inlinecode"><span class="id" title="var">multi</span></span> <span class="inlinecode"><span class="id" title="var">R</span></span> relates two
    elements <span class="inlinecode"><span class="id" title="var">x</span></span> and <span class="inlinecode"><span class="id" title="var">y</span></span> if

<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">y</span></span>, or

</li>
<li> <span class="inlinecode"><span class="id" title="var">R</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span>, or

</li>
<li> there is some nonempty sequence <span class="inlinecode"><span class="id" title="var">z<sub>1</sub></span></span>, <span class="inlinecode"><span class="id" title="var">z<sub>2</sub></span></span>, ..., <span class="inlinecode"><span class="id" title="var">zn</span></span> such that
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">z<sub>1</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">R</span> <span class="id" title="var">z<sub>1</sub></span> <span class="id" title="var">z<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">R</span> <span class="id" title="var">zn</span> <span class="id" title="var">y</span>.
</span>
</li>
</ul>
    Intuitively, if <span class="inlinecode"><span class="id" title="var">R</span></span> describes a single-step of computation, then
    <span class="inlinecode"><span class="id" title="var">z<sub>1</sub></span></span> ... <span class="inlinecode"><span class="id" title="var">zn</span></span> are the intermediate steps of computation that get
    us from <span class="inlinecode"><span class="id" title="var">x</span></span> to <span class="inlinecode"><span class="id" title="var">y</span></span>. 
<div class="paragraph"> </div>

<a id="lab148"></a><h3 class="section"> </h3>
 We write <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>&gt;</span><span style='vertical-align:15%;'>*</span></span></span></span> for the <span class="inlinecode"><span class="id" title="var">multi</span></span> <span class="inlinecode"><span class="id" title="var">step</span></span> relation on terms. 
</div>
<div class="code">

<span class="id" title="keyword">Notation</span> &quot; t '<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>&gt;</span><span style='vertical-align:15%;'>*</span></span></span>' t' " := (<span class="id" title="var">multi</span> <span class="id" title="var">step</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40).<br/>
</div>

<div class="doc">
The relation <span class="inlinecode"><span class="id" title="var">multi</span></span> <span class="inlinecode"><span class="id" title="var">R</span></span> has several crucial properties.

<div class="paragraph"> </div>

    First, it is obviously <i>reflexive</i> (that is, <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">x</span>,</span> <span class="inlinecode"><span class="id" title="var">multi</span></span> <span class="inlinecode"><span class="id" title="var">R</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span>
    <span class="inlinecode"><span class="id" title="var">x</span></span>).  In the case of the <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>&gt;</span><span style='vertical-align:15%;'>*</span></span></span></span> (i.e., <span class="inlinecode"><span class="id" title="var">multi</span></span> <span class="inlinecode"><span class="id" title="var">step</span></span>) relation, the
    intuition is that a term can execute to itself by taking zero
    steps of execution. 
<div class="paragraph"> </div>

<a id="lab149"></a><h3 class="section"> </h3>
 Second, it contains <span class="inlinecode"><span class="id" title="var">R</span></span> -- that is, single-step executions are a
    particular case of multi-step executions.  (It is this fact that
    justifies the word "closure" in the term "multi-step closure of
    <span class="inlinecode"><span class="id" title="var">R</span></span>.") 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">multi_R</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">R</span> : <span class="id" title="var">relation</span> <span class="id" title="var">X</span>) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> → (<span class="id" title="var">multi</span> <span class="id" title="var">R</span>) <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>
<div class="togglescript" id="proofcontrol5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')"><span class="show"></span></div>
<div class="proofscript" id="proof5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">multi_step</span> <span class="id" title="keyword">with</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">multi_refl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab150"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Third, <span class="inlinecode"><span class="id" title="var">multi</span></span> <span class="inlinecode"><span class="id" title="var">R</span></span> is <i>transitive</i>. 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">multi_trans</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">R</span> : <span class="id" title="var">relation</span> <span class="id" title="var">X</span>) (<span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> : <span class="id" title="var">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">multi</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">multi</span> <span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">multi</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">z</span>.<br/>
<div class="togglescript" id="proofcontrol6" onclick="toggleDisplay('proof6');toggleDisplay('proofcontrol6')"><span class="show"></span></div>
<div class="proofscript" id="proof6" onclick="toggleDisplay('proof6');toggleDisplay('proofcontrol6')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> <span class="id" title="var">G</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">G</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;multi_refl&nbsp;*)</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;multi_step&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">multi_step</span> <span class="id" title="keyword">with</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHG</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
In particular, for the <span class="inlinecode"><span class="id" title="var">multi</span></span> <span class="inlinecode"><span class="id" title="var">step</span></span> relation on terms, if
    <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>&gt;</span><span style='vertical-align:15%;'>*</span></span></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> and <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>&gt;</span><span style='vertical-align:15%;'>*</span></span></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>3</sub></span></span>, then <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>&gt;</span><span style='vertical-align:15%;'>*</span></span></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>3</sub></span></span>. 
</div>

<div class="doc">
<a id="lab151"></a><h2 class="section">Examples</h2>

<div class="paragraph"> </div>

 Here's a specific instance of the <span class="inlinecode"><span class="id" title="var">multi</span></span> <span class="inlinecode"><span class="id" title="var">step</span></span> relation: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">test_multistep_1</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> (<span class="id" title="var">C</span> 0) (<span class="id" title="var">C</span> 3))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> (<span class="id" title="var">C</span> 2) (<span class="id" title="var">C</span> 4))<br/>
&nbsp;&nbsp;&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>&gt;</span><span style='vertical-align:15%;'>*</span></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">C</span> 9.<br/>
<div class="togglescript" id="proofcontrol7" onclick="toggleDisplay('proof7');toggleDisplay('proofcontrol7')"><span class="show"></span></div>
<div class="proofscript" id="proof7" onclick="toggleDisplay('proof7');toggleDisplay('proofcontrol7')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">multi_step</span>. { <span class="id" title="tactic">apply</span> <span class="id" title="var">ST_Plus1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">ST_PlusConstConst</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">multi_step</span>. { <span class="id" title="tactic">apply</span> <span class="id" title="var">ST_Plus2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">v_const</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ST_PlusConstConst</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">multi_step</span>. { <span class="id" title="tactic">apply</span> <span class="id" title="var">ST_PlusConstConst</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">multi_refl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Restart</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">sauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab152"></a><h2 class="section">Normal Forms Again</h2>

<div class="paragraph"> </div>

 If <span class="inlinecode"><span class="id" title="var">t</span></span> reduces to <span class="inlinecode"><span class="id" title="var">t'</span></span> in zero or more steps and <span class="inlinecode"><span class="id" title="var">t'</span></span> is a
    normal form, we say that "<span class="inlinecode"><span class="id" title="var">t'</span></span> is a normal form of <span class="inlinecode"><span class="id" title="var">t</span></span>." 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">step_normal_form</span> := <span class="id" title="var">normal_form</span> <span class="id" title="var">step</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">normal_form_of</span> (<span class="id" title="var">t</span> <span class="id" title="var">t'</span> : <span class="id" title="var">tm</span>) :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">t</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>&gt;</span><span style='vertical-align:15%;'>*</span></span></span> <span class="id" title="var">t'</span> ∧ <span class="id" title="var">step_normal_form</span> <span class="id" title="var">t'</span>).<br/>
</div>

<div class="doc">
<a id="lab153"></a><h3 class="section"> </h3>
 Notice:

<div class="paragraph"> </div>

<ul class="doclist">
<li> single-step reduction is deterministic;

<div class="paragraph"> </div>


</li>
<li> so, if <span class="inlinecode"><span class="id" title="var">t</span></span> can reach a normal form, then this normal form is unique;

<div class="paragraph"> </div>


</li>
<li> so we can pronounce <span class="inlinecode"><span class="id" title="var">normal_form</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">t'</span></span> as "<span class="inlinecode"><span class="id" title="var">t'</span></span> is <i>the</i>
        normal form of <span class="inlinecode"><span class="id" title="var">t</span></span>." 
</li>
</ul>

<div class="paragraph"> </div>

<a id="lab154"></a><h3 class="section"> </h3>
 Indeed, something stronger is true (for this language):

<div class="paragraph"> </div>

<ul class="doclist">
<li> the reduction of <i>any</i> term <span class="inlinecode"><span class="id" title="var">t</span></span> will eventually reach a
         normal form

</li>
</ul>

<div class="paragraph"> </div>

    We say the <span class="inlinecode"><span class="id" title="var">step</span></span> relation is <i>normalizing</i>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">normalizing</span> {<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">R</span> : <span class="id" title="var">relation</span> <span class="id" title="var">X</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">t</span>, <span class="id" title="tactic">∃</span> <span class="id" title="var">t'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">multi</span> <span class="id" title="var">R</span>) <span class="id" title="var">t</span> <span class="id" title="var">t'</span> ∧ <span class="id" title="var">normal_form</span> <span class="id" title="var">R</span> <span class="id" title="var">t'</span>.<br/>
</div>

<div class="doc">
we can indeed prove that our definition of <span class="inlinecode"><span class="id" title="var">step</span></span> admits
one normalizing sequence:

<div class="paragraph"> </div>

<span class="inlinecode"><span class="id" title="keyword">Theorem</span></span> <span class="inlinecode"><span class="id" title="var">step_normalizing</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">normalizing</span></span> <span class="inlinecode"><span class="id" title="var">step</span>.</span>

<div class="paragraph"> </div>

The not too difficult proof can be found in the full version of the book.

</div>

<div class="doc">
<a id="lab155"></a><h2 class="section">Equivalence of Big-Step and Small-Step</h2>

<div class="paragraph"> </div>

 Having defined the operational semantics of our tiny programming
    language in two different ways (big-step and small-step), it makes
    sense to ask whether these definitions actually define the same
    thing! 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">eval__multistep</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t</span> <span class="id" title="var">n</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">t</span> ==&gt; <span class="id" title="var">n</span> → <span class="id" title="var">t</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>&gt;</span><span style='vertical-align:15%;'>*</span></span></span> <span class="id" title="var">C</span> <span class="id" title="var">n</span>.<br/>
</div>

<div class="doc">
<a id="lab156"></a><h3 class="section"> </h3>
 The key ideas in the proof can be seen in the following picture:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>            (<span class="id" title="tactic">by</span> <span class="id" title="var">ST_Plus1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">t<sub>1</sub>'</span> <span class="id" title="var">t<sub>2</sub></span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>           (<span class="id" title="tactic">by</span> <span class="id" title="var">ST_Plus1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">t<sub>1</sub>''</span> <span class="id" title="var">t<sub>2</sub></span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>          (<span class="id" title="tactic">by</span> <span class="id" title="var">ST_Plus1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> (<span class="id" title="var">C</span> <span class="id" title="var">v<sub>1</sub></span>) <span class="id" title="var">t<sub>2</sub></span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>        (<span class="id" title="tactic">by</span> <span class="id" title="var">ST_Plus2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> (<span class="id" title="var">C</span> <span class="id" title="var">v<sub>1</sub></span>) <span class="id" title="var">t<sub>2</sub>'</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>       (<span class="id" title="tactic">by</span> <span class="id" title="var">ST_Plus2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> (<span class="id" title="var">C</span> <span class="id" title="var">v<sub>1</sub></span>) <span class="id" title="var">t<sub>2</sub>''</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>      (<span class="id" title="tactic">by</span> <span class="id" title="var">ST_Plus2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> (<span class="id" title="var">C</span> <span class="id" title="var">v<sub>1</sub></span>) (<span class="id" title="var">C</span> <span class="id" title="var">v<sub>2</sub></span>) <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>    (<span class="id" title="tactic">by</span> <span class="id" title="var">ST_PlusConstConst</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">C</span> (<span class="id" title="var">v<sub>1</sub></span> + <span class="id" title="var">v<sub>2</sub></span>)
</span>     
<div class="paragraph"> </div>

<a id="lab157"></a><h3 class="section"> </h3>
 That is, the multistep reduction of a term of the form <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>
    proceeds in three phases:
<ul class="doclist">
<li> First, we use <span class="inlinecode"><span class="id" title="var">ST_Plus1</span></span> some number of times to reduce <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>
         to a normal form, which must (by <span class="inlinecode"><span class="id" title="var">nf_same_as_value</span></span>) be a
         term of the form <span class="inlinecode"><span class="id" title="var">C</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span> for some <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span></span>.

</li>
<li> Next, we use <span class="inlinecode"><span class="id" title="var">ST_Plus2</span></span> some number of times to reduce <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>
         to a normal form, which must again be a term of the form <span class="inlinecode"><span class="id" title="var">C</span></span>
         <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span></span> for some <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span></span>.

</li>
<li> Finally, we use <span class="inlinecode"><span class="id" title="var">ST_PlusConstConst</span></span> one time to reduce <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">(<span class="id" title="var">C</span></span>
         <span class="inlinecode"><span class="id" title="var">v<sub>1</sub></span>)</span> <span class="inlinecode">(<span class="id" title="var">C</span></span> <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span>)</span> to <span class="inlinecode"><span class="id" title="var">C</span></span> <span class="inlinecode">(<span class="id" title="var">v<sub>1</sub></span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span>)</span>. 

</li>
</ul>

<div class="paragraph"> </div>

To formalize this intuition, you'll need  some congruence
    lemmas  plus some basic
    properties of <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>&gt;</span><span style='vertical-align:15%;'>*</span></span></span></span>: that it is reflexive, transitive, and
    includes <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span>.
</div>
<div class="code">

<div class="togglescript" id="proofcontrol8" onclick="toggleDisplay('proof8');toggleDisplay('proofcontrol8')"><span class="show"></span></div>
<div class="proofscript" id="proof8" onclick="toggleDisplay('proof8');toggleDisplay('proofcontrol8')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab158"></a><h3 class="section"> </h3>
 For the other direction, we need one lemma, which establishes a
    relation between single-step reduction and big-step evaluation. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">step__eval</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span> <span class="id" title="var">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">t'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t'</span> ==&gt; <span class="id" title="var">n</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t</span>  ==&gt; <span class="id" title="var">n</span>.<br/>
<div class="togglescript" id="proofcontrol9" onclick="toggleDisplay('proof9');toggleDisplay('proofcontrol9')"><span class="show"></span></div>
<div class="proofscript" id="proof9" onclick="toggleDisplay('proof9');toggleDisplay('proofcontrol9')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span> <span class="id" title="var">n</span> <span class="id" title="var">Hs</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab159"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 The fact that small-step reduction implies big-step evaluation is now
    straightforward to prove.

<div class="paragraph"> </div>

    The proof proceeds by induction on the multi-step reduction
    sequence that is buried in the hypothesis <span class="inlinecode"><span class="id" title="var">normal_form_of</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">t'</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">multistep__eval</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">normal_form_of</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span> → <span class="id" title="tactic">∃</span> <span class="id" title="var">n</span>, <span class="id" title="var">t'</span> = <span class="id" title="var">C</span> <span class="id" title="var">n</span> ∧ <span class="id" title="var">t</span> ==&gt; <span class="id" title="var">n</span>.<br/>
<div class="togglescript" id="proofcontrol10" onclick="toggleDisplay('proof10');toggleDisplay('proofcontrol10')"><span class="show"></span></div>
<div class="proofscript" id="proof10" onclick="toggleDisplay('proof10');toggleDisplay('proofcontrol10')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab160"></a><h1 class="section">Small-Step Imp</h1>

<div class="paragraph"> </div>

 Now for a more serious example: a small-step version of the Imp
    operational semantics. 
<div class="paragraph"> </div>

  We start with an inductive definition of arithmetic values -- we do not need
the same for booleans

<div class="paragraph"> </div>

Then we introduce relational definitions for small-step reduction relations for arithmetic and
    boolean expressions are straightforward extensions of the tiny
    language we've been working up to now.   
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">aval</span> : <span class="id" title="var">aexp</span> → <span class="id" title="keyword">Prop</span> :=<br/>
| <span class="id" title="var">av_num</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span>, <span class="id" title="var">aval</span> (<span class="id" title="var">ANum</span> <span class="id" title="var">n</span>).<br/>
</div>

<div class="doc">
<a id="lab161"></a><h3 class="section">Small-step evaluation relation for arithmetic expressions</h3>
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (AS_Id) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">i / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> (st i)</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">a<sub>1</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> a<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (AS_Plus1) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">a<sub>1</sub> + a<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> a<sub>1</sub>' + a<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">aval v<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> a<sub>2</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (AS_Plus2) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">v<sub>1</sub> + a<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> v<sub>1</sub> + a<sub>2</sub>'</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (AS_Plus) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">v<sub>1</sub> + v<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> (v<sub>1</sub> + v<sub>2</sub>)</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">a<sub>1</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> a<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (AS_Minus1) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">a<sub>1</sub> - a<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> a<sub>1</sub>' - a<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">aval v<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> a<sub>2</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (AS_Minus2) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">v<sub>1</sub> - a<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> v<sub>1</sub> - a<sub>2</sub>'</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (AS_Minus) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">v<sub>1</sub> - v<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> (v<sub>1</sub> - v<sub>2</sub>)</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">a<sub>1</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> a<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (AS_Mult1) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">a<sub>1</sub> * a<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> a<sub>1</sub>' * a<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">aval v<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> a<sub>2</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (AS_Mult2) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">v<sub>1</sub> * a<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> v<sub>1</sub> * a<sub>2</sub>'</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (AS_Mult) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">v<sub>1</sub> * v<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> (v<sub>1</sub> * v<sub>2</sub>)</td>
  <td></td>
</tr>
</table></center>
</div>

<div class="doc">
<a id="lab162"></a><h3 class="section">Small-step evaluation relation for boolean expressions</h3>
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">a<sub>1</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> a<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (BS_Eq<sub>1</sub>) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">a<sub>1</sub> = a<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> a<sub>1</sub>' = a<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">aval v<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> a<sub>2</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (BS_Eq<sub>2</sub>) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">v<sub>1</sub> = a<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> v<sub>1</sub> = a<sub>2</sub>'</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (BS_Eq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">v<sub>1</sub> = v<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> (if (v<sub>1</sub> =? v<sub>2</sub>) then true else false)</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">a<sub>1</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> a<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (BS_LtEq1) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">a<sub>1</sub> <= a<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> a<sub>1</sub>' <= a<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">aval v<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> a<sub>2</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (BS_LtEq2) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">v<sub>1</sub> <= a<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> v<sub>1</sub> <= a<sub>2</sub>'</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (BS_LtEq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">v<sub>1</sub> <= v<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> (if (v<sub>1</sub> <=? v<sub>2</sub>) then true else false)</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">b<sub>1</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> b<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (BS_NotStep) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">~b<sub>1</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> ~b<sub>1</sub>'</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (BS_NotTrue) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">~ true / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> false</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (BS_NotFalse) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">~ false / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> true</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">b<sub>1</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> b<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (BS_AndStep) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">b<sub>1</sub> && b<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> b<sub>1</sub>' && b<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">b<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> b<sub>2</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (BS_AndTrueStep) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">true && b<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> true && b<sub>2</sub>'</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (BS_AndFalse) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">false && b<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> false</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (BS_AndTrueTrue) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">true && true / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> true</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (BS_AndTrueFalse) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">true && false / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> false</td>
  <td></td>
</tr>
</table></center>
</div>

<div class="doc">
<a id="lab163"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 The semantics of commands is the interesting part.  We need two
    small tricks to make it work:

<div class="paragraph"> </div>

<ul class="doclist">
<li> We use <span class="inlinecode"><span class="id" title="var">skip</span></span> as a "command value" -- i.e., a command that
         has reached a normal form.

<div class="paragraph"> </div>

<ul class="doclist">
<li> An assignment command reduces to <span class="inlinecode"><span class="id" title="var">skip</span></span> (and an updated
              state).

<div class="paragraph"> </div>


</li>
<li> The sequencing command waits until its left-hand
              subcommand has reduced to <span class="inlinecode"><span class="id" title="var">skip</span></span>, then throws it away so
              that reduction can continue with the right-hand
              subcommand.

<div class="paragraph"> </div>


</li>
</ul>

</li>
<li> We reduce a <span class="inlinecode"><span class="id" title="var">while</span></span> command by transforming it into a
         conditional followed by the same <span class="inlinecode"><span class="id" title="var">while</span></span>.

<div class="paragraph"> </div>


</li>
<li> We could have given a similar presentation using <i>big</i> step for

</li>
</ul>
arithmetic and boolean expressions.

<div class="paragraph"> </div>

<ul class="doclist">
<li> It is possible to show that big and the reflexive and transitive

</li>
</ul>
  closure of small step presentations of Imp semantics, coincide but
  it's lengthy.  

<div class="paragraph"> </div>


<div class="paragraph"> </div>

<a id="lab164"></a><h3 class="section">Small-step evaluation relation for commands</h3>
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">a<sub>1</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> a<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (CS_AsgnStep) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">i := a<sub>1</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> i := a<sub>1</sub>' / st</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (CS_Asgn) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">i := n / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> skip / (i !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> n ; st)</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">c<sub>1</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> c<sub>1</sub>' / st'</td>
  <td class="infrulenamecol" rowspan="3">
    (CS_SeqStep) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">c<sub>1</sub> ; c<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> c<sub>1</sub>' ; c<sub>2</sub> / st'</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (CS_SeqFinish) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">skip ; c<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> c<sub>2</sub> / st</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">b<sub>1</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> b<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (CS_IfStep) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">if b<sub>1</sub> then c<sub>1</sub> else c<sub>2</sub> end / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">if b<sub>1</sub>' then c<sub>1</sub> else c<sub>2</sub> end / st</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (CS_IfTrue) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">if true then c<sub>1</sub> else c<sub>2</sub> end / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> c<sub>1</sub> / st</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (CS_IfFalse) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">if false then c<sub>1</sub> else c<sub>2</sub> end / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> c<sub>2</sub> / st</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (CS_While) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">while b<sub>1</sub> do c<sub>1</sub> end / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">if b<sub>1</sub> then (c<sub>1</sub>; while b<sub>1</sub> do c<sub>1</sub> end) else skip end / st</td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>

<a id="lab165"></a><h3 class="section"> </h3>
 We can distinguish different outcomes of the computation

<div class="paragraph"> </div>

<ul class="doclist">
<li> when it terminates

<div class="paragraph"> </div>


</li>
<li> when it diverges

<div class="paragraph"> </div>


</li>
<li> when it "goes wrong", if it cannot reduce and is not a final
  configuration, that is, c' &lt;&gt; SKIP.

</li>
</ul>

<div class="paragraph"> </div>

We can show that this relation is

<div class="paragraph"> </div>

<ul class="doclist">
<li> deterministic (easy)

<div class="paragraph"> </div>


</li>
<li> coincides with big step evalution (long) 

</li>
</ul>
</div>

<div class="doc">
<a id="lab166"></a><h1 class="section">Concurrent Imp</h1>

<div class="paragraph"> </div>

 Finally, let's define a <i>concurrent</i> extension of Imp, to
    show off the power of our new tools... 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">com</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">CSkip</span> : <span class="id" title="var">com</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">CAsgn</span> : <span class="id" title="var">string</span> → <span class="id" title="var">aexp</span> → <span class="id" title="var">com</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">CSeq</span> : <span class="id" title="var">com</span> → <span class="id" title="var">com</span> → <span class="id" title="var">com</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">CIf</span> : <span class="id" title="var">bexp</span> → <span class="id" title="var">com</span> → <span class="id" title="var">com</span> → <span class="id" title="var">com</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">CWhile</span> : <span class="id" title="var">bexp</span> → <span class="id" title="var">com</span> → <span class="id" title="var">com</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">CPar</span> : <span class="id" title="var">com</span> → <span class="id" title="var">com</span> → <span class="id" title="var">com</span>. <span class="comment">(*&nbsp;&lt;---&nbsp;NEW&nbsp;*)</span><br/><hr class='doublespaceincode'/>
</div>

<div class="doc">
<a id="lab167"></a><h3 class="section">New small-step evaluation relation for commands</h3>
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">c<sub>1</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> c<sub>1</sub>' / st'</td>
  <td class="infrulenamecol" rowspan="3">
    (CS_Par1) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">c<sub>1</sub> || c<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> c<sub>1</sub>' || c<sub>2</sub> / st'</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">c<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> c<sub>2</sub>' / st'</td>
  <td class="infrulenamecol" rowspan="3">
    (CS_Par2) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">c<sub>1</sub> || c<sub>2</sub> / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> c<sub>1</sub> || c<sub>2</sub>' / st'</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (CS_ParDone) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">skip || skip / st <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> skip / st</td>
  <td></td>
</tr>
</table></center>
</div>

<div class="doc">
<a id="lab168"></a><h3 class="section"> </h3>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">cmultistep</span> := <span class="id" title="var">multi</span> <span class="id" title="var">cstep</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> &quot; t '/' st '<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>&gt;</span><span style='vertical-align:15%;'>*</span></span></span>' t' '/' st' " :=<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="var">multi</span> <span class="id" title="var">cstep</span>  (<span class="id" title="var">t</span>,<span class="id" title="var">st</span>) (<span class="id" title="var">t'</span>,<span class="id" title="var">st'</span>))<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40, <span class="id" title="var">st</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 39, <span class="id" title="var">t'</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 39).<br/><hr class='doublespaceincode'/>
 <!-- /quiz -->
</div><div class="quiz">


<div class="doc">
Which state <i>cannot</i> be obtained as a result of executing the
    following program (from some starting state)?
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Y</span> := 1 || <span class="id" title="var">Y</span> := 2);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">Y</span>
</span>
<div class="paragraph"> </div>

    (1) <span class="inlinecode"><span class="id" title="var">Y</span>=0</span> and <span class="inlinecode"><span class="id" title="var">X</span>=0</span>

<div class="paragraph"> </div>

    (2) <span class="inlinecode"><span class="id" title="var">Y</span>=1</span> and <span class="inlinecode"><span class="id" title="var">X</span>=1</span>

<div class="paragraph"> </div>

    (3) <span class="inlinecode"><span class="id" title="var">Y</span>=2</span> and <span class="inlinecode"><span class="id" title="var">X</span>=2</span>

<div class="paragraph"> </div>

    (4) None of the above

<div class="paragraph"> </div>


</div>
</div> <!-- /quiz -->
<div class="quiz">


<div class="doc">
Which state(s) <i>cannot</i> be obtained as a result of executing the
    following program (from some starting state)?
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Y</span> := 1 || <span class="id" title="var">Y</span> := <span class="id" title="var">Y</span> + 1);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">Y</span>
</span>
<div class="paragraph"> </div>

    (1) <span class="inlinecode"><span class="id" title="var">Y</span>=1</span> and <span class="inlinecode"><span class="id" title="var">X</span>=1</span>

<div class="paragraph"> </div>

    (2) <span class="inlinecode"><span class="id" title="var">Y</span>=0</span> and <span class="inlinecode"><span class="id" title="var">X</span>=1</span>

<div class="paragraph"> </div>

    (3) <span class="inlinecode"><span class="id" title="var">Y</span>=2</span> and <span class="inlinecode"><span class="id" title="var">X</span>=2</span>

<div class="paragraph"> </div>

    (4) <span class="inlinecode"><span class="id" title="var">Y</span>=<span class="id" title="var">n</span></span> and <span class="inlinecode"><span class="id" title="var">X</span>=<span class="id" title="var">n</span></span> for any <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">≥</span> <span class="inlinecode">3</span>

<div class="paragraph"> </div>

    (5) 2 and 4 above

<div class="paragraph"> </div>

    (6) None of the above

<div class="paragraph"> </div>


</div>
</div> <!-- /quiz -->
<div class="quiz">


<div class="doc">
How about this one?
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( <span class="id" title="var">Y</span> := 0; <span class="id" title="var">X</span> := <span class="id" title="var">Y</span> + 1 )<br/>
&nbsp;&nbsp;&nbsp;||<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( <span class="id" title="var">Y</span> := <span class="id" title="var">Y</span> + 1; <span class="id" title="var">X</span> := 1 )
</span>
<div class="paragraph"> </div>

    (1) <span class="inlinecode"><span class="id" title="var">Y</span>=0</span> and <span class="inlinecode"><span class="id" title="var">X</span>=1</span>

<div class="paragraph"> </div>

    (2) <span class="inlinecode"><span class="id" title="var">Y</span>=1</span> and <span class="inlinecode"><span class="id" title="var">X</span>=1</span>

<div class="paragraph"> </div>

    (3) <span class="inlinecode"><span class="id" title="var">Y</span>=0</span> and <span class="inlinecode"><span class="id" title="var">X</span>=0</span>

<div class="paragraph"> </div>

    (4) <span class="inlinecode"><span class="id" title="var">Y</span>=4</span> and <span class="inlinecode"><span class="id" title="var">X</span>=1</span>

<div class="paragraph"> </div>

    (5) None of the above

<div class="paragraph"> </div>


</div>
</div> <!-- /quiz -->

<div class="doc">
<a id="lab169"></a><h3 class="section"> </h3>
 Among the many interesting properties of this language is the fact
    that the following program can terminate with the variable <span class="inlinecode"><span class="id" title="var">X</span></span> set
    to any value. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">par_loop</span> : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;&lt;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;||<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> (<span class="id" title="var">Y</span> = 0) <span class="id" title="tactic">do</span> <span class="id" title="var">X</span> := <span class="id" title="var">X</span> + 1 <span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;}&gt;.<br/><hr class='doublespaceincode'/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>